"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[143],{2004:function(t,e,s){var i=s(7901),o=s(2840),n=s(9401),r=s(9399),h=s(6692),a=s(4204),c=s(7895),l=s(2971),u=s(4401),d=s(3156),p=s(2141),g=s(1013),v=s(6638),m=s(4735),f=s(2697);i.Z.Board=function(t,e,s,n,h,a,c,l,u,p,f){if(this.BOARD_MODE_NONE=0,this.BOARD_MODE_DRAG=1,this.BOARD_MODE_MOVE_ORIGIN=2,this.BOARD_MODE_ZOOM=17,this.BOARD_QUALITY_LOW=1,this.BOARD_QUALITY_HIGH=2,g.Z.exists(f.document)&&!1!==f.document?this.document=f.document:m.Z.isBrowser&&(this.document=document),this.container="",this.containerObj=null,g.Z.isString(t)?(this.container=t,this.containerObj=m.Z.isBrowser?this.document.getElementById(this.container):null):m.Z.isBrowser&&(this.containerObj=t,this.container=this.containerObj.getAttribute("id"),null===this.container&&(this.container="null"+parseInt(1e8*Math.random()).toString())),m.Z.isBrowser&&"no"!==e.type&&null===this.containerObj)throw Error('\nJSXGraph: HTML container element "'+t+'" not found.');this.renderer=e,this.grids=[],this.options=g.Z.deepCopy(r.Z),this.attr=f,"default"!==this.attr.theme&&g.Z.exists(i.Z.themes[this.attr.theme])&&g.Z.mergeAttr(this.options,i.Z.themes[this.attr.theme],!0),this.dimension=2,this.jc=new d.Z,this.jc.use(this),this.origin={},this.origin.usrCoords=[1,0,0],this.origin.scrCoords=[1,n[0],n[1]],this.zoomX=h,this.zoomY=a,this.unitX=c*this.zoomX,this.unitY=l*this.zoomY,this.keepaspectratio=!1,this.canvasWidth=u,this.canvasHeight=p,g.Z.exists(s)&&""!==s&&m.Z.isBrowser&&!g.Z.exists(this.document.getElementById(s))?this.id=s:this.id=this.generateId(),v.Z.eventify(this),this.hooks=[],this.dependentBoards=[],this.inUpdate=!1,this.objects={},this.objectsList=[],this.groups={},this.animationObjects={},this.highlightedObjects={},this.numObjects=0,this.elementsByName={},this.mode=this.BOARD_MODE_NONE,this.updateQuality=this.BOARD_QUALITY_HIGH,this.isSuspendedRedraw=!1,this.calculateSnapSizes(),this.drag_dx=0,this.drag_dy=0,this.drag_position=[0,0],this.mouse={},this.touches=[],this.xmlString="",this.cPos=[],this.touchMoveLast=0,this.touchMoveLastId=1/0,this.positionAccessLast=0,this.downObjects=[],this.focusObjects=[],this.attr.showcopyright&&this.renderer.displayCopyright(o.Z.licenseText,parseInt(this.options.text.fontSize,10)),this.needsFullUpdate=!1,this.reducedUpdate=!1,this.currentCBDef="none",this.geonextCompatibilityMode=!1,this.options.text.useASCIIMathML&&translateASCIIMath?init():this.options.text.useASCIIMathML=!1,this.hasMouseHandlers=!1,this.hasTouchHandlers=!1,this.hasPointerHandlers=!1,this.hasWheelHandlers=!1,this.hasMouseUp=!1,this.hasTouchEnd=!1,this.hasPointerUp=!1,this._drag_offset=[0,0],this._inputDevice="mouse",this._board_touches=[],this.selectingMode=!1,this.isSelecting=!1,this._isScrolling=!1,this._isResizing=!1,this.selectingBox=[[0,0],[0,0]],this.userLog=[],this.mathLib=Math,this.mathLibJXG=i.Z.Math,!0===this.attr.registerevents?this.attr.registerevents={fullscreen:!0,keyboard:!0,pointer:!0,resize:!0,wheel:!0}:"object"!=typeof this.attr.registerevents||(g.Z.exists(this.attr.registerevents.fullscreen)||(this.attr.registerevents.fullscreen=!0),g.Z.exists(this.attr.registerevents.keyboard)||(this.attr.registerevents.keyboard=!0),g.Z.exists(this.attr.registerevents.pointer)||(this.attr.registerevents.pointer=!0),g.Z.exists(this.attr.registerevents.resize)||(this.attr.registerevents.resize=!0),g.Z.exists(this.attr.registerevents.wheel)||(this.attr.registerevents.wheel=!0)),!1!==this.attr.registerevents&&(this.attr.registerevents.fullscreen&&this.addFullscreenEventHandlers(),this.attr.registerevents.keyboard&&this.addKeyboardEventHandlers(),this.attr.registerevents.pointer&&this.addEventHandlers(),this.attr.registerevents.resize&&this.addResizeEventHandlers(),this.attr.registerevents.wheel&&this.addWheelEventHandlers()),this.methodMap={update:"update",fullUpdate:"fullUpdate",on:"on",off:"off",trigger:"trigger",setAttribute:"setAttribute",setBoundingBox:"setBoundingBox",setView:"setBoundingBox",migratePoint:"migratePoint",colorblind:"emulateColorblindness",suspendUpdate:"suspendUpdate",unsuspendUpdate:"unsuspendUpdate",clearTraces:"clearTraces",left:"clickLeftArrow",right:"clickRightArrow",up:"clickUpArrow",down:"clickDownArrow",zoomIn:"zoomIn",zoomOut:"zoomOut",zoom100:"zoom100",zoomElements:"zoomElements",remove:"removeObject",removeObject:"removeObject"}},i.Z.extend(i.Z.Board.prototype,{generateName:function(t){var e,s,i=this.attr.maxnamelength,n="",r="",h=[],a="";if(t.type===o.Z.OBJECT_TYPE_TICKS)return"";for(e=g.Z.isPoint(t)||g.Z.isPoint3D(t)?["","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"]:t.type===o.Z.OBJECT_TYPE_ANGLE?["","&alpha;","&beta;","&gamma;","&delta;","&epsilon;","&zeta;","&eta;","&theta;","&iota;","&kappa;","&lambda;","&mu;","&nu;","&xi;","&omicron;","&pi;","&rho;","&sigma;","&tau;","&upsilon;","&phi;","&chi;","&psi;","&omega;"]:["","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],g.Z.isPoint(t)||t.elementClass===o.Z.OBJECT_CLASS_LINE||t.type===o.Z.OBJECT_TYPE_ANGLE||(n=t.type===o.Z.OBJECT_TYPE_POLYGON?"P_{":t.elementClass===o.Z.OBJECT_CLASS_CIRCLE?"k_{":t.elementClass===o.Z.OBJECT_CLASS_TEXT?"t_{":"s_{",r="}"),s=0;s<i;s++)h[s]=0;for(;h[i-1]<e.length;){for(h[0]=1;h[0]<e.length;h[0]++){for(a=n,s=i;s>0;s--)a+=e[h[s-1]];if(!g.Z.exists(this.elementsByName[a+r]))return a+r}for(s=1,h[0]=e.length;s<i;s++)h[s-1]===e.length&&(h[s-1]=1,h[s]+=1)}return""},generateId:function(){for(var t=1;g.Z.exists(i.Z.boards["jxgBoard"+t]);)t=Math.round(65535*Math.random());return"jxgBoard"+t},setId:function(t,e){var s,i=this.numObjects,o=t.id;if(this.numObjects+=1,""===o||!g.Z.exists(o))for(o=this.id+e+i;g.Z.exists(this.objects[o]);)s=Math.round(65535*Math.random()),o=this.id+e+i+"-"+s;return t.id=o,this.objects[o]=t,t._pos=this.objectsList.length,this.objectsList[this.objectsList.length]=t,o},finalizeAdding:function(t){!1===g.Z.evaluate(t.visProp.visible)&&this.renderer.display(t,!1)},finalizeLabel:function(t){t.hasLabel&&!g.Z.evaluate(t.label.visProp.islabel)&&!1===g.Z.evaluate(t.label.visProp.visible)&&this.renderer.display(t.label,!1)},checkFrameRate:function(t){var e=!1,s=new Date().getTime();return g.Z.exists(t.pointerId)&&this.touchMoveLastId!==t.pointerId&&(e=!0,this.touchMoveLastId=t.pointerId),!e&&(s-this.touchMoveLast)*this.attr.maxframerate>=1e3&&(e=!0),e&&(this.touchMoveLast=s),e},getCoordsTopLeftCorner:function(){var t,e,s,i,o,n=this.document.ownerDocument||this.document,r=n.documentElement||this.document.body.parentNode,h=n.body,a=this.containerObj;if(this.cPos.length>0&&(this.mode===this.BOARD_MODE_DRAG||this.mode===this.BOARD_MODE_MOVE_ORIGIN||new Date().getTime()-this.positionAccessLast<1e3))return this.cPos;if(this.positionAccessLast=new Date().getTime(),a.getBoundingClientRect){for(s=a.getBoundingClientRect(),i=1,o=a;o&&g.Z.exists(o.parentNode);)g.Z.exists(o.style)&&g.Z.exists(o.style.zoom)&&""!==o.style.zoom&&(i*=parseFloat(o.style.zoom)),o=o.parentNode;return t=[s.left*i,s.top*i],t[0]+=m.Z.getProp(a,"border-left-width"),t[1]+=m.Z.getProp(a,"border-top-width"),"vml"!==this.renderer.type&&(t[0]+=m.Z.getProp(a,"padding-left"),t[1]+=m.Z.getProp(a,"padding-top")),this.cPos=t.slice(),this.cPos}return t=m.Z.getOffset(a),e=this.document.documentElement.ownerDocument,!this.containerObj.currentStyle&&e.defaultView&&(t[0]+=m.Z.getProp(r,"margin-left"),t[1]+=m.Z.getProp(r,"margin-top"),t[0]+=m.Z.getProp(r,"border-left-width"),t[1]+=m.Z.getProp(r,"border-top-width"),t[0]+=m.Z.getProp(r,"padding-left"),t[1]+=m.Z.getProp(r,"padding-top")),h&&(t[0]+=m.Z.getProp(h,"left"),t[1]+=m.Z.getProp(h,"top")),"object"==typeof google&&google.translate&&(t[0]+=10,t[1]+=25),t[0]+=m.Z.getProp(a,"border-left-width"),t[1]+=m.Z.getProp(a,"border-top-width"),"vml"!==this.renderer.type&&(t[0]+=m.Z.getProp(a,"padding-left"),t[1]+=m.Z.getProp(a,"padding-top")),t[0]+=this.attr.offsetx,t[1]+=this.attr.offsety,this.cPos=t.slice(),this.cPos},getMousePosition:function(t,e){var s,i,o=this.getCoordsTopLeftCorner();return s=m.Z.getPosition(t,e,this.document),this.updateCSSTransforms(),i=[1,s[0]-o[0],s[1]-o[1]],i=a.Z.matVecMult(this.cssTransMat,i),i[1]/=i[0],i[2]/=i[0],[i[1],i[2]]},initMoveOrigin:function(t,e){this.drag_dx=t-this.origin.scrCoords[1],this.drag_dy=e-this.origin.scrCoords[2],this.mode=this.BOARD_MODE_MOVE_ORIGIN,this.updateQuality=this.BOARD_QUALITY_LOW},initMoveObject:function(t,e,s,i){var n,r,h,a=[],c=[],l=this.objectsList.length,d={visProp:{layer:-1e4}};for(r=0,this._shiftKey=s.shiftKey,this._ctrlKey=s.ctrlKey;r<l;r++)h=(n=this.objectsList[r]).hasPoint&&n.hasPoint(t,e),n.visPropCalc.visible&&h&&(n.triggerEventHandlers([i+"down","down"],[s]),this.downObjects.push(n)),h&&n.isDraggable&&n.visPropCalc.visible&&(this.geonextCompatibilityMode&&(g.Z.isPoint(n)||n.elementClass===o.Z.OBJECT_CLASS_TEXT)||!this.geonextCompatibilityMode)&&!g.Z.evaluate(n.visProp.fixed)&&(n.visProp.layer>d.visProp.layer||n.visProp.layer===d.visProp.layer&&n.lastDragTime.getTime()>=d.lastDragTime.getTime())&&(!this.attr.ignorelabels||!g.Z.exists(d.label)||n!==d.label)&&(d=n,a.push(d),g.Z.exists(d.coords)?c.push(u.Z.subtract(d.coords.scrCoords.slice(1),[t,e])):c.push([0,0]));return this.attr.drag.enabled&&a.length>0&&(this.mode=this.BOARD_MODE_DRAG),this.attr.takefirst?(a.length=1,this._drag_offset=c[0]):(a=a.slice(-1),this._drag_offset=c[c.length-1]),this._drag_offset||(this._drag_offset=[0,0]),"svg"===this.renderer.type&&g.Z.exists(a[0])&&g.Z.evaluate(a[0].visProp.dragtotopoflayer)&&1===a.length&&g.Z.exists(a[0].rendNode)&&a[0].rendNode.parentNode.appendChild(a[0].rendNode),a.length>=1&&(a[0].highlight(!0),this.triggerEventHandlers(["mousehit","hit"],[s,a[0]])),a},moveObject:function(t,e,s,i,r){var h,a,c,l=new n.Z(o.Z.COORDS_BY_SCREEN,this.getScrCoordsOfMouse(t,e),this);s&&s.obj&&((h=s.obj).coords&&(a=h.coords.scrCoords.slice()),this.addLogEntry("drag",h,l.usrCoords.slice(1)),this.drag_position=[l.scrCoords[1],l.scrCoords[2]],this.drag_position=u.Z.add(this.drag_position,this._drag_offset),this._shiftKey=i.shiftKey,this._ctrlKey=i.ctrlKey,g.Z.exists(h.coords)?h.setPositionDirectly(o.Z.COORDS_BY_SCREEN,this.drag_position):(this.displayInfobox(!1),isNaN(s.targets[0].Xprev+s.targets[0].Yprev)||h.setPositionDirectly(o.Z.COORDS_BY_SCREEN,[l.scrCoords[1],l.scrCoords[2]],[s.targets[0].Xprev,s.targets[0].Yprev]),s.targets[0].Xprev=l.scrCoords[1],s.targets[0].Yprev=l.scrCoords[2]),g.Z.exists(h.coords)&&(h.prepareUpdate().update(!1).updateRenderer(),this.updateInfobox(h),h.prepareUpdate().update(!0).updateRenderer()),h.coords&&(c=h.coords.scrCoords),h.coords&&a[1]===c[1]&&a[2]===c[2]||(h.triggerEventHandlers([r+"drag","drag"],[i]),this.update()),h.highlight(!0),this.triggerEventHandlers(["mousehit","hit"],[i,h]),h.lastDragTime=new Date)},twoFingerMove:function(t,e,s){var i;g.Z.exists(t)&&g.Z.exists(t.obj)&&((i=t.obj).elementClass===o.Z.OBJECT_CLASS_LINE||i.type===o.Z.OBJECT_TYPE_POLYGON?this.twoFingerTouchObject(t.targets,i,e):i.elementClass===o.Z.OBJECT_CLASS_CIRCLE&&this.twoFingerTouchCircle(t.targets,i,e),s&&i.triggerEventHandlers(["touchdrag","drag"],[s]))},getTwoFingerTransform(t,e,s,i){var r,h,c,l,u,d,p,g,v,m,f,b,_,O,Z,E,y,C,w;return h=(r=new n.Z(o.Z.COORDS_BY_SCREEN,[t.Xprev,t.Yprev],this).usrCoords)[1],c=r[2],l=(r=new n.Z(o.Z.COORDS_BY_SCREEN,[e.Xprev,e.Yprev],this).usrCoords)[1],u=r[2],g=(r=new n.Z(o.Z.COORDS_BY_SCREEN,[t.X,t.Y],this).usrCoords)[1],v=r[2],m=(r=new n.Z(o.Z.COORDS_BY_SCREEN,[e.X,e.Y],this).usrCoords)[1],f=r[2],d=l-h,p=u-c,b=m-g,_=f-v,E=d*d+p*p,O=(b*d+_*p)/E,Z=(_*d-b*p)/E,s||(w=a.Z.hypot(O,Z),O/=w,Z/=w),i||(Z=0),y=.5*(g+m-O*(h+l)+Z*(c+u)),C=.5*(v+f-Z*(h+l)-O*(c+u)),[1,0,0,y,O,-Z,C,Z,O]},twoFingerTouchObject:function(t,e,s){var i,n,r,h,a,c,l=!1;if(g.Z.exists(t[0])&&g.Z.exists(t[1])&&!isNaN(t[0].Xprev+t[0].Yprev+t[1].Xprev+t[1].Yprev)){if(n=this.getTwoFingerTransform(t[0],t[1],g.Z.evaluate(e.visProp.scalable),g.Z.evaluate(e.visProp.rotatable)),(i=this.create("transform",n,{type:"generic"})).update(),e.elementClass===o.Z.OBJECT_CLASS_LINE)r=[],e.point1.draggable()&&r.push(e.point1),e.point2.draggable()&&r.push(e.point2),i.applyOnce(r);else if(e.type===o.Z.OBJECT_TYPE_POLYGON){for(h=0,a=e.vertices.length-1,c=e.visProp,l=g.Z.evaluate(c.snaptogrid)||g.Z.evaluate(c.snaptopoints);h<a&&!l;++h)c=e.vertices[h].visProp,l=(l=l||g.Z.evaluate(c.snaptogrid)||g.Z.evaluate(c.snaptopoints))||!e.vertices[h].draggable();if(!l){for(h=0,r=[];h<a;++h)e.vertices[h].draggable()&&r.push(e.vertices[h]);i.applyOnce(r)}}this.update(),e.highlight(!0)}},twoFingerTouchCircle:function(t,e,s){var i,r,h,a,l,u,d,p,v,m,f;"pointCircle"!==e.method&&"pointLine"!==e.method&&g.Z.exists(t[0])&&g.Z.exists(t[1])&&!isNaN(t[0].Xprev+t[0].Yprev+t[1].Xprev+t[1].Yprev)&&(s===t[0].num?(i=t[1],r=t[0]):(i=t[0],r=t[1]),l=new n.Z(o.Z.COORDS_BY_SCREEN,[i.Xprev,i.Yprev],this).usrCoords,a=new n.Z(o.Z.COORDS_BY_SCREEN,[r.Xprev,r.Yprev],this).usrCoords,h=new n.Z(o.Z.COORDS_BY_SCREEN,[r.X,r.Y],this).usrCoords,d=c.Z.rad(a.slice(1),l.slice(1),h.slice(1)),p=this.create("transform",[-l[1],-l[2]],{type:"translate"}),v=this.create("transform",[d],{type:"rotate"}),p.melt(v),g.Z.evaluate(e.visProp.scalable)&&(u=c.Z.distance(l,h)/c.Z.distance(l,a),m=this.create("transform",[u,u],{type:"scale"}),p.melt(m)),f=this.create("transform",[l[1],l[2]],{type:"translate"}),p.melt(f),e.center.draggable()&&p.applyOnce([e.center]),"twoPoints"===e.method?e.point2.draggable()&&p.applyOnce([e.point2]):"pointRadius"===e.method&&g.Z.isNumber(e.updateRadius.origin)&&e.setRadius(e.radius*u),this.update(e.center),e.highlight(!0))},highlightElements:function(t,e,s,i){var o,n,r,h={},a=this.objectsList.length;for(o=0;o<a;o++)r=(n=this.objectsList[o]).id,g.Z.exists(n.hasPoint)&&n.visPropCalc.visible&&n.hasPoint(t,e)&&(this.updateInfobox(n),g.Z.exists(this.highlightedObjects[r])||(h[r]=n,n.highlight(),this.triggerEventHandlers(["mousehit","hit"],[s,n,i])),n.mouseover?n.triggerEventHandlers(["mousemove","move"],[s]):(n.triggerEventHandlers(["mouseover","over"],[s]),n.mouseover=!0));for(o=0;o<a;o++)r=(n=this.objectsList[o]).id,n.mouseover&&!h[r]&&(n.triggerEventHandlers(["mouseout","out"],[s]),n.mouseover=!1)},saveStartPos:function(t,e){var s,n,r=[];if(t.type===o.Z.OBJECT_TYPE_TICKS)r.push([1,NaN,NaN]);else if(t.elementClass===o.Z.OBJECT_CLASS_LINE)r.push(t.point1.coords.usrCoords),r.push(t.point2.coords.usrCoords);else if(t.elementClass===o.Z.OBJECT_CLASS_CIRCLE)r.push(t.center.coords.usrCoords),"twoPoints"===t.method&&r.push(t.point2.coords.usrCoords);else if(t.type===o.Z.OBJECT_TYPE_POLYGON)for(s=0,n=t.vertices.length-1;s<n;s++)r.push(t.vertices[s].coords.usrCoords);else if(t.type===o.Z.OBJECT_TYPE_SECTOR)r.push(t.point1.coords.usrCoords),r.push(t.point2.coords.usrCoords),r.push(t.point3.coords.usrCoords);else if(g.Z.isPoint(t)||t.type===o.Z.OBJECT_TYPE_GLIDER)r.push(t.coords.usrCoords);else if(t.elementClass===o.Z.OBJECT_CLASS_CURVE)t.points.length>0&&r.push(t.points[0].usrCoords);else try{r.push(t.coords.usrCoords)}catch(t){i.Z.debug("JSXGraph+ saveStartPos: obj.coords.usrCoords not available: "+t)}for(s=0,n=r.length;s<n;s++)e.Zstart.push(r[s][0]),e.Xstart.push(r[s][1]),e.Ystart.push(r[s][2])},mouseOriginMoveStart:function(t){var e,s;return(e=this._isRequiredKeyPressed(t,"pan"))&&(s=this.getMousePosition(t),this.initMoveOrigin(s[0],s[1])),e},mouseOriginMove:function(t){var e,s=this.mode===this.BOARD_MODE_MOVE_ORIGIN;return s&&(e=this.getMousePosition(t),this.moveOrigin(e[0],e[1],!0)),s},touchStartMoveOriginOneFinger:function(t){var e,s,o=t[i.Z.touchProperty];return(e=this.attr.pan.enabled&&!this.attr.pan.needtwofingers&&1===o.length)&&(s=this.getMousePosition(t,0),this.initMoveOrigin(s[0],s[1])),e},touchOriginMove:function(t){var e,s=this.mode===this.BOARD_MODE_MOVE_ORIGIN;return s&&(e=this.getMousePosition(t,0),this.moveOrigin(e[0],e[1],!0)),s},originMoveEnd:function(){this.updateQuality=this.BOARD_QUALITY_HIGH,this.mode=this.BOARD_MODE_NONE},addEventHandlers:function(){m.Z.supportsPointerEvents()?this.addPointerEventHandlers():(this.addMouseEventHandlers(),this.addTouchEventHandlers()),null!==this.containerObj&&(this.containerObj.oncontextmenu=function(t){return g.Z.exists(t)&&t.preventDefault(),!1})},addResizeEventHandlers:function(){if(m.Z.isBrowser){try{this.startResizeObserver()}catch(t){m.Z.addEvent(window,"resize",this.resizeListener,this),this.startIntersectionObserver()}m.Z.addEvent(window,"scroll",this.scrollListener,this)}},removeEventHandlers:function(){this.removeMouseEventHandlers(),this.removeTouchEventHandlers(),this.removePointerEventHandlers(),this.removeFullscreenEventHandlers(),this.removeKeyboardEventHandlers(),m.Z.isBrowser&&(g.Z.exists(this.resizeObserver)?this.stopResizeObserver():(m.Z.removeEvent(window,"resize",this.resizeListener,this),this.stopIntersectionObserver()),m.Z.removeEvent(window,"scroll",this.scrollListener,this))},addPointerEventHandlers:function(){if(!this.hasPointerHandlers&&m.Z.isBrowser){var t=this.attr.movetarget||this.containerObj;window.navigator.msPointerEnabled?(m.Z.addEvent(this.containerObj,"MSPointerDown",this.pointerDownListener,this),m.Z.addEvent(t,"MSPointerMove",this.pointerMoveListener,this)):(m.Z.addEvent(this.containerObj,"pointerdown",this.pointerDownListener,this),m.Z.addEvent(t,"pointermove",this.pointerMoveListener,this),m.Z.addEvent(t,"pointerleave",this.pointerLeaveListener,this)),null!==this.containerObj&&(this.containerObj.style.touchAction="none"),this.hasPointerHandlers=!0}},addMouseEventHandlers:function(){if(!this.hasMouseHandlers&&m.Z.isBrowser){var t=this.attr.movetarget||this.containerObj;m.Z.addEvent(this.containerObj,"mousedown",this.mouseDownListener,this),m.Z.addEvent(t,"mousemove",this.mouseMoveListener,this),this.hasMouseHandlers=!0}},addTouchEventHandlers:function(t){if(!this.hasTouchHandlers&&m.Z.isBrowser){var e=this.attr.movetarget||this.containerObj;m.Z.addEvent(this.containerObj,"touchstart",this.touchStartListener,this),m.Z.addEvent(e,"touchmove",this.touchMoveListener,this),this.hasTouchHandlers=!0}},addWheelEventHandlers:function(){!this.hasWheelHandlers&&m.Z.isBrowser&&(m.Z.addEvent(this.containerObj,"mousewheel",this.mouseWheelListener,this),m.Z.addEvent(this.containerObj,"DOMMouseScroll",this.mouseWheelListener,this),this.hasWheelHandlers=!0)},addFullscreenEventHandlers:function(){var t,e=["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","msfullscreenchange"],s=e.length;if(!this.hasFullscreenEventHandlers&&m.Z.isBrowser){for(t=0;t<s;t++)m.Z.addEvent(this.document,e[t],this.fullscreenListener,this);this.hasFullscreenEventHandlers=!0}},addKeyboardEventHandlers:function(){this.attr.keyboard.enabled&&!this.hasKeyboardHandlers&&m.Z.isBrowser&&(m.Z.addEvent(this.containerObj,"keydown",this.keyDownListener,this),m.Z.addEvent(this.containerObj,"focusin",this.keyFocusInListener,this),m.Z.addEvent(this.containerObj,"focusout",this.keyFocusOutListener,this),this.hasKeyboardHandlers=!0)},removeKeyboardEventHandlers:function(){this.hasKeyboardHandlers&&m.Z.isBrowser&&(m.Z.removeEvent(this.containerObj,"keydown",this.keyDownListener,this),m.Z.removeEvent(this.containerObj,"focusin",this.keyFocusInListener,this),m.Z.removeEvent(this.containerObj,"focusout",this.keyFocusOutListener,this),this.hasKeyboardHandlers=!1)},removeFullscreenEventHandlers:function(){var t,e=["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","msfullscreenchange"],s=e.length;if(this.hasFullscreenEventHandlers&&m.Z.isBrowser){for(t=0;t<s;t++)m.Z.removeEvent(this.document,e[t],this.fullscreenListener,this);this.hasFullscreenEventHandlers=!1}},removePointerEventHandlers:function(){if(this.hasPointerHandlers&&m.Z.isBrowser){var t=this.attr.movetarget||this.containerObj;window.navigator.msPointerEnabled?(m.Z.removeEvent(this.containerObj,"MSPointerDown",this.pointerDownListener,this),m.Z.removeEvent(t,"MSPointerMove",this.pointerMoveListener,this)):(m.Z.removeEvent(this.containerObj,"pointerdown",this.pointerDownListener,this),m.Z.removeEvent(t,"pointermove",this.pointerMoveListener,this),m.Z.removeEvent(t,"pointerleave",this.pointerLeaveListener,this)),this.hasWheelHandlers&&(m.Z.removeEvent(this.containerObj,"mousewheel",this.mouseWheelListener,this),m.Z.removeEvent(this.containerObj,"DOMMouseScroll",this.mouseWheelListener,this)),this.hasPointerUp&&(window.navigator.msPointerEnabled?m.Z.removeEvent(this.document,"MSPointerUp",this.pointerUpListener,this):(m.Z.removeEvent(this.document,"pointerup",this.pointerUpListener,this),m.Z.removeEvent(this.document,"pointercancel",this.pointerUpListener,this)),this.hasPointerUp=!1),this.hasPointerHandlers=!1}},removeMouseEventHandlers:function(){if(this.hasMouseHandlers&&m.Z.isBrowser){var t=this.attr.movetarget||this.containerObj;m.Z.removeEvent(this.containerObj,"mousedown",this.mouseDownListener,this),m.Z.removeEvent(t,"mousemove",this.mouseMoveListener,this),this.hasMouseUp&&(m.Z.removeEvent(this.document,"mouseup",this.mouseUpListener,this),this.hasMouseUp=!1),this.hasWheelHandlers&&(m.Z.removeEvent(this.containerObj,"mousewheel",this.mouseWheelListener,this),m.Z.removeEvent(this.containerObj,"DOMMouseScroll",this.mouseWheelListener,this)),this.hasMouseHandlers=!1}},removeTouchEventHandlers:function(){if(this.hasTouchHandlers&&m.Z.isBrowser){var t=this.attr.movetarget||this.containerObj;m.Z.removeEvent(this.containerObj,"touchstart",this.touchStartListener,this),m.Z.removeEvent(t,"touchmove",this.touchMoveListener,this),this.hasTouchEnd&&(m.Z.removeEvent(this.document,"touchend",this.touchEndListener,this),this.hasTouchEnd=!1),this.hasTouchHandlers=!1}},clickLeftArrow:function(){return this.moveOrigin(this.origin.scrCoords[1]+.1*this.canvasWidth,this.origin.scrCoords[2]),this},clickRightArrow:function(){return this.moveOrigin(this.origin.scrCoords[1]-.1*this.canvasWidth,this.origin.scrCoords[2]),this},clickUpArrow:function(){return this.moveOrigin(this.origin.scrCoords[1],this.origin.scrCoords[2]-.1*this.canvasHeight),this},clickDownArrow:function(){return this.moveOrigin(this.origin.scrCoords[1],this.origin.scrCoords[2]+.1*this.canvasHeight),this},gestureChangeListener:function(t){var e,s,i,r,h,a,l,u,d,p=[],v=[],m=!1,f=this.attr.zoom.factorx,b=this.attr.zoom.factory,_=!1;return this.mode!==this.BOARD_MODE_ZOOM||(t.preventDefault(),r=c.Z.distance([t.touches[0].clientX,t.touches[0].clientY],[t.touches[1].clientX,t.touches[1].clientY],2),void 0===t.scale&&(t.scale=r/this.prevDist),!!g.Z.exists(this.prevCoords)&&(p=[t.touches[0].clientX-this.prevCoords[0][0],t.touches[0].clientY-this.prevCoords[0][1]],v=[t.touches[1].clientX-this.prevCoords[1][0],t.touches[1].clientY-this.prevCoords[1][1]],(!(p[0]*p[0]+p[1]*p[1]<100)||!(v[0]*v[0]+v[1]*v[1]<100))&&(s=c.Z.rad(p,[0,0],v),"pan"!==this.isPreviousGesture&&Math.abs(s)>.2*Math.PI&&Math.abs(s)<1.8*Math.PI&&(m=!0),"pan"!==this.isPreviousGesture&&!m&&(.77>Math.abs(t.scale)||Math.abs(t.scale)>1.3)&&(m=!0),i=t.scale/this.prevScale,this.prevScale=t.scale,this.prevCoords=[[t.touches[0].clientX,t.touches[0].clientY],[t.touches[1].clientX,t.touches[1].clientY]],e=new n.Z(o.Z.COORDS_BY_SCREEN,this.getMousePosition(t,0),this),this.attr.pan.enabled&&this.attr.pan.needtwofingers&&!m?(this.isPreviousGesture="pan",this.moveOrigin(e.scrCoords[1],e.scrCoords[2],!0)):this.attr.zoom.enabled&&.5>Math.abs(i-1)&&(_=!1,(this.attr.zoom.pinchhorizontal||this.attr.zoom.pinchvertical)&&(l=Math.abs(t.touches[0].clientX-t.touches[1].clientX),h=Math.abs(Math.atan2(Math.abs(t.touches[0].clientY-t.touches[1].clientY),l)),a=Math.PI*this.attr.zoom.pinchsensitivity/90),!this.keepaspectratio&&this.attr.zoom.pinchhorizontal&&h<a?(this.attr.zoom.factorx=i,this.attr.zoom.factory=1,u=0,d=0,_=!0):!this.keepaspectratio&&this.attr.zoom.pinchvertical&&Math.abs(h-.5*Math.PI)<a?(this.attr.zoom.factorx=1,this.attr.zoom.factory=i,u=0,d=0,_=!0):this.attr.zoom.pinch&&(this.attr.zoom.factorx=i,this.attr.zoom.factory=i,u=e.usrCoords[1],d=e.usrCoords[2],_=!0),_&&(this.zoomIn(u,d),this.attr.zoom.factorx=f,this.attr.zoom.factory=b)),!1)))},gestureStartListener:function(t){var e;return t.preventDefault(),this.prevScale=1,this.prevDist=c.Z.distance([t.touches[0].clientX,t.touches[0].clientY],[t.touches[1].clientX,t.touches[1].clientY],2),this.prevCoords=[[t.touches[0].clientX,t.touches[0].clientY],[t.touches[1].clientX,t.touches[1].clientY]],this.isPreviousGesture="none",e=this.getMousePosition(t,0),this.initMoveOrigin(e[0],e[1]),this.mode=this.BOARD_MODE_ZOOM,!1},_isRequiredKeyPressed:function(t,e){var s=this.attr[e];return!!s.enabled&&(!!s.needshift&&!!t.shiftKey||!s.needshift&&!t.shiftKey)&&(!!s.needctrl&&!!t.ctrlKey||!s.needctrl&&!t.ctrlKey)},_isPointerRegistered:function(t){var e,s=this._board_touches.length;for(e=0;e<s;e++)if(this._board_touches[e].pointerId===t.pointerId)return!0;return!1},_pointerStorePosition:function(t){var e,s;for(e=0,s=!1;e<this._board_touches.length;e++)if(this._board_touches[e].pointerId===t.pointerId){this._board_touches[e].clientX=t.clientX,this._board_touches[e].clientY=t.clientY,s=!0;break}return!s&&this._board_touches.length<2&&this._board_touches.push({pointerId:t.pointerId,clientX:t.clientX,clientY:t.clientY}),this},_pointerRemoveTouches:function(t){var e;for(e=0;e<this._board_touches.length;e++)if(this._board_touches[e].pointerId===t.pointerId){this._board_touches.splice(e,1);break}return this},_pointerClearTouches:function(t){this._board_touches.length>0&&this.dehighlightAll(),this.updateQuality=this.BOARD_QUALITY_HIGH,this.mode=this.BOARD_MODE_NONE,this._board_touches=[],this.touches=[]},_getPointerInputDevice:function(t){if(m.Z.isBrowser){if("touch"===t.pointerType||window.navigator.msMaxTouchPoints&&window.navigator.msMaxTouchPoints>1)return"touch";if("mouse"===t.pointerType)return"mouse";if("pen"===t.pointerType)return"pen"}return"mouse"},pointerDownListener:function(t,e,s){var i,o,n,r,h,a,c,l,u,d,p="mouse";if(!e&&this._isPointerRegistered(t))return!1;if(null===g.Z.evaluate(this.attr.movetarget)&&g.Z.exists(t.target)&&g.Z.exists(t.target.releasePointerCapture)&&t.target.releasePointerCapture(t.pointerId),e||t.isPrimary,this.hasPointerUp||(window.navigator.msPointerEnabled?m.Z.addEvent(this.document,"MSPointerUp",this.pointerUpListener,this):(m.Z.addEvent(this.document,"pointerup",this.pointerUpListener,this),m.Z.addEvent(this.document,"pointercancel",this.pointerUpListener,this)),this.hasPointerUp=!0),this.hasMouseHandlers&&this.removeMouseEventHandlers(),this.hasTouchHandlers&&this.removeTouchEventHandlers(),this.document.selection&&g.Z.isFunction(this.document.selection.empty))this.document.selection.empty();else if(window.getSelection&&(a=window.getSelection()).removeAllRanges)try{a.removeAllRanges()}catch(t){}if(this._inputDevice=this._getPointerInputDevice(t),p=this._inputDevice,this.options.precision.hasPoint=this.options.precision[p],r=this.getMousePosition(t),this._testForSelection(t),this.selectingMode){this._startSelecting(r),this.triggerEventHandlers(["touchstartselecting","pointerstartselecting","startselecting"],[t]);return}if(this.attr.drag.enabled&&e?(h=[e],this.mode=this.BOARD_MODE_DRAG):h=this.initMoveObject(r[0],r[1],t,p),c={num:t.pointerId,X:r[0],Y:r[1],Xprev:NaN,Yprev:NaN,Xstart:[],Ystart:[],Zstart:[]},h.length>0){for(i=0,u=h[h.length-1],l=!1;i<this.touches.length;i++)if(this.touches[i].obj===u){o=i,n=this.touches[i].targets.push(c)-1,l=!0;break}l||(n=0,o=this.touches.push({obj:u,targets:[c]})-1),this.dehighlightAll(),u.highlight(!0),this.saveStartPos(u,this.touches[o].targets[n]),t&&t.preventDefault&&!s&&t.preventDefault()}return this.touches.length>0&&!s&&(t.preventDefault(),t.stopPropagation()),!!m.Z.isBrowser&&("touch"!==this._getPointerInputDevice(t)?this.mode===this.BOARD_MODE_NONE&&this.mouseOriginMoveStart(t):(this._pointerStorePosition(t),t.touches=this._board_touches,1===t.touches.length&&this.mode===this.BOARD_MODE_NONE&&this.touchStartMoveOriginOneFinger(t)||2===t.touches.length&&(this.mode===this.BOARD_MODE_NONE||this.mode===this.BOARD_MODE_MOVE_ORIGIN)&&(this.mode===this.BOARD_MODE_MOVE_ORIGIN&&this.originMoveEnd(),this.gestureStartListener(t))),d="none",this.mode===this.BOARD_MODE_NONE&&g.Z.evaluate(this.attr.browserpan)&&!(g.Z.evaluate(this.attr.pan.enabled)&&!g.Z.evaluate(this.attr.pan.needtwofingers))&&(d="pan-x pan-y"),this.containerObj.style.touchAction=d,this.triggerEventHandlers(["touchstart","down","pointerdown","MSPointerDown"],[t]),!0)},pointerMoveListener:function(t){var e,s,i,o,n,r="mouse";if("touch"===this._getPointerInputDevice(t)&&!this._isPointerRegistered(t))return this.BOARD_MODE_NONE;if(!this.checkFrameRate(t))return!1;if(this.mode!==this.BOARD_MODE_DRAG&&(this.dehighlightAll(),this.displayInfobox(!1)),this.mode!==this.BOARD_MODE_NONE&&(t.preventDefault(),t.stopPropagation()),this.updateQuality=this.BOARD_QUALITY_LOW,this._inputDevice=this._getPointerInputDevice(t),r=this._inputDevice,this.options.precision.hasPoint=this.options.precision[r],o=.3333*this.options.precision.hasPoint,i=this.getMousePosition(t),null===g.Z.evaluate(this.attr.movetarget)&&i[0]<=o||i[1]<=o||i[0]>=this.canvasWidth-o||i[1]>=this.canvasHeight-o)return this.mode===this.BOARD_MODE_NONE;if(this.selectingMode)this._moveSelecting(i),this.triggerEventHandlers(["touchmoveselecting","moveselecting","pointermoveselecting"],[t,this.mode]);else if(!this.mouseOriginMove(t)){if(this.mode===this.BOARD_MODE_DRAG){for(e=0;e<this.touches.length;e++)for(s=0,n=this.touches[e].targets;s<n.length;s++)if(n[s].num===t.pointerId){n[s].X=i[0],n[s].Y=i[1],1===n.length?this.moveObject(i[0],i[1],this.touches[e],t,r):2===n.length&&(this.twoFingerMove(this.touches[e],t.pointerId,t),n[s].Xprev=i[0],n[s].Yprev=i[1]);break}}else"touch"===this._getPointerInputDevice(t)&&(this._pointerStorePosition(t),2===this._board_touches.length&&(t.touches=this._board_touches,this.gestureChangeListener(t))),this.highlightElements(i[0],i[1],t,-1)}return this.triggerEventHandlers(["pointermove","MSPointerMove","move"],[t,this.mode]),this.updateQuality=this.BOARD_QUALITY_HIGH,this.mode===this.BOARD_MODE_NONE},pointerUpListener:function(t){var e,s,i,o,n=!1;if(this.triggerEventHandlers(["touchend","up","pointerup","MSPointerUp"],[t]),this.displayInfobox(!1),t){for(e=0;e<this.touches.length;e++)for(s=0,o=this.touches[e].targets;s<o.length;s++)if(o[s].num===t.pointerId){o.splice(s,1),0===o.length&&this.touches.splice(e,1);break}}if(this.originMoveEnd(),this.update(),this.selectingMode)this._stopSelecting(t),this.triggerEventHandlers(["touchstopselecting","pointerstopselecting","stopselecting"],[t]),this.stopSelectionMode();else for(e=this.downObjects.length-1;e>-1;e--){for(s=0,i=!1;s<this.touches.length;s++)this.touches[s].obj.id===this.downObjects[e].id&&(i=!0);i||(this.downObjects[e].triggerEventHandlers(["touchend","up","pointerup","MSPointerUp"],[t]),g.Z.exists(this.downObjects[e].coords)||(this.downObjects[e].snapToGrid(),this.downObjects[e].snapToPoints(),n=!0),this.downObjects.splice(e,1))}return this.hasPointerUp&&(window.navigator.msPointerEnabled?m.Z.removeEvent(this.document,"MSPointerUp",this.pointerUpListener,this):(m.Z.removeEvent(this.document,"pointerup",this.pointerUpListener,this),m.Z.removeEvent(this.document,"pointercancel",this.pointerUpListener,this)),this.hasPointerUp=!1),this._pointerClearTouches(t.pointerId),"touch"!==this._getPointerInputDevice(t)&&this.dehighlightAll(),n&&this.update(),!0},pointerLeaveListener:function(t){return this.displayInfobox(!1),this.dehighlightAll(),!0},touchStartListener:function(t){var e,s,n,h,a,c,l,u,d,p,v=this.options.precision.touch,f=t[i.Z.touchProperty];for(this.hasTouchEnd||(m.Z.addEvent(this.document,"touchend",this.touchEndListener,this),this.hasTouchEnd=!0),this.document.selection&&g.Z.isFunction(this.document.selection.empty)?this.document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges(),this._inputDevice="touch",this.options.precision.hasPoint=this.options.precision.touch,e=0;e<f.length;e++)f[e].jxg_isused=!1;for(e=0;e<this.touches.length;e++)for(h=0,p=this.touches[e].targets;h<p.length;h++){p[h].num=-1,v=this.options.precision.touch;do{for(a=0;a<f.length;a++)if(Math.abs(Math.pow(f[a].screenX-p[h].X,2)+Math.pow(f[a].screenY-p[h].Y,2))<v*v){p[h].num=a,p[h].X=f[a].screenX,p[h].Y=f[a].screenY,f[a].jxg_isused=!0;break}v*=2}while(-1===p[h].num&&v<this.options.precision.touchMax);-1===p[h].num&&(i.Z.debug("i couldn't find a targettouches for target no "+h+" on "+this.touches[e].obj.name+" ("+this.touches[e].obj.id+"). Removed the target."),i.Z.debug("eps = "+v+", touchMax = "+r.Z.precision.touchMax),p.splice(e,1))}for(e=0;e<f.length;e++)if(!f[e].jxg_isused){if(s=this.getMousePosition(t,e),this.selectingMode)return this._startSelecting(s),this.triggerEventHandlers(["touchstartselecting","startselecting"],[t]),t.preventDefault(),t.stopPropagation(),this.options.precision.hasPoint=this.options.precision.mouse,this.touches.length>0;if(0!==(n=this.initMoveObject(s[0],s[1],t,"touch")).length){if(c=n[n.length-1],d={num:e,X:f[e].screenX,Y:f[e].screenY,Xprev:NaN,Yprev:NaN,Xstart:[],Ystart:[],Zstart:[]},g.Z.isPoint(c)||c.elementClass===o.Z.OBJECT_CLASS_TEXT||c.type===o.Z.OBJECT_TYPE_TICKS||c.type===o.Z.OBJECT_TYPE_IMAGE)u=[d],this.saveStartPos(c,u[0]),this.touches.push({obj:c,targets:u}),c.highlight(!0);else if(c.elementClass===o.Z.OBJECT_CLASS_LINE||c.elementClass===o.Z.OBJECT_CLASS_CIRCLE||c.elementClass===o.Z.OBJECT_CLASS_CURVE||c.type===o.Z.OBJECT_TYPE_POLYGON){for(h=0,l=!1;h<this.touches.length;h++)c.id===this.touches[h].obj.id&&(l=!0,1===this.touches[h].targets.length&&(this.saveStartPos(c,d),this.touches[h].targets.push(d)),f[e].jxg_isused=!0);l||(u=[d],this.saveStartPos(c,u[0]),this.touches.push({obj:c,targets:u}),c.highlight(!0))}}f[e].jxg_isused=!0}return this.touches.length>0&&(t.preventDefault(),t.stopPropagation()),1===f.length&&this.mode===this.BOARD_MODE_NONE&&this.touchStartMoveOriginOneFinger(t)||2===f.length&&(this.mode===this.BOARD_MODE_NONE||this.mode===this.BOARD_MODE_MOVE_ORIGIN)&&(this.mode===this.BOARD_MODE_MOVE_ORIGIN&&this.originMoveEnd(),this.gestureStartListener(t)),this.options.precision.hasPoint=this.options.precision.mouse,this.triggerEventHandlers(["touchstart","down"],[t]),!1},touchMoveListener:function(t){var e,s,o,n,r=t[i.Z.touchProperty];if(!this.checkFrameRate(t))return!1;if(this.mode!==this.BOARD_MODE_NONE&&(t.preventDefault(),t.stopPropagation()),this.mode!==this.BOARD_MODE_DRAG&&(this.dehighlightAll(),this.displayInfobox(!1)),this._inputDevice="touch",this.options.precision.hasPoint=this.options.precision.touch,this.updateQuality=this.BOARD_QUALITY_LOW,this.selectingMode){for(e=0;e<r.length;e++)if(!r[e].jxg_isused){s=this.getMousePosition(t,e),this._moveSelecting(s),this.triggerEventHandlers(["touchmoves","moveselecting"],[t,this.mode]);break}}else if(!this.touchOriginMove(t)){if(this.mode===this.BOARD_MODE_DRAG){for(e=0;e<this.touches.length;e++)if(1===(n=this.touches[e].targets).length){if(r[n[0].num]){if((s=this.getMousePosition(t,n[0].num))[0]<0||s[0]>this.canvasWidth||s[1]<0||s[1]>this.canvasHeight)return;n[0].X=s[0],n[0].Y=s[1],this.moveObject(s[0],s[1],this.touches[e],t,"touch")}}else if(2===n.length&&n[0].num>-1&&n[1].num>-1&&r[n[0].num]&&r[n[1].num]){if(s=this.getMousePosition(t,n[0].num),o=this.getMousePosition(t,n[1].num),s[0]<0||s[0]>this.canvasWidth||s[1]<0||s[1]>this.canvasHeight||o[0]<0||o[0]>this.canvasWidth||o[1]<0||o[1]>this.canvasHeight)return;n[0].X=s[0],n[0].Y=s[1],n[1].X=o[0],n[1].Y=o[1],this.twoFingerMove(this.touches[e],n[0].num,t),n[0].Xprev=s[0],n[0].Yprev=s[1],n[1].Xprev=o[0],n[1].Yprev=o[1]}}else 2===r.length&&this.gestureChangeListener(t),s=this.getMousePosition(t,0),this.highlightElements(s[0],s[1],t,-1)}return this.mode!==this.BOARD_MODE_DRAG&&this.displayInfobox(!1),this.triggerEventHandlers(["touchmove","move"],[t,this.mode]),this.options.precision.hasPoint=this.options.precision.mouse,this.updateQuality=this.BOARD_QUALITY_HIGH,this.mode===this.BOARD_MODE_NONE},touchEndListener:function(t){var e,s,n,r,h,a,c=this.options.precision.touch,l=[],u=t&&t[i.Z.touchProperty],d=!1;if(this.triggerEventHandlers(["touchend","up"],[t]),this.displayInfobox(!1),this.selectingMode)this._stopSelecting(t),this.triggerEventHandlers(["touchstopselecting","stopselecting"],[t]),this.stopSelectionMode();else if(u&&u.length>0){for(e=0;e<this.touches.length;e++)l[e]=this.touches[e];for(e=0,this.touches.length=0;e<u.length;e++)u[e].jxg_isused=!1;for(e=0;e<l.length;e++){for(s=0,r=!1,h=0,a=l[e].targets;s<a.length;s++)for(n=0,a[s].found=!1;n<u.length;n++)if(Math.abs(Math.pow(u[n].screenX-a[s].X,2)+Math.pow(u[n].screenY-a[s].Y,2))<c*c){a[s].found=!0,a[s].num=n,a[s].X=u[n].screenX,a[s].Y=u[n].screenY,h+=1;break}if(g.Z.isPoint(l[e].obj)?r=a[0]&&a[0].found:l[e].obj.elementClass===o.Z.OBJECT_CLASS_LINE?r=a[0]&&a[0].found||a[1]&&a[1].found:l[e].obj.elementClass===o.Z.OBJECT_CLASS_CIRCLE&&(r=1===h||3===h),r)for(this.touches.push({obj:l[e].obj,targets:[]}),s=0;s<a.length;s++)a[s].found&&this.touches[this.touches.length-1].targets.push({num:a[s].num,X:a[s].screenX,Y:a[s].screenY,Xprev:NaN,Yprev:NaN,Xstart:a[s].Xstart,Ystart:a[s].Ystart,Zstart:a[s].Zstart});else l[e].obj.noHighlight()}}else this.touches.length=0;for(e=this.downObjects.length-1;e>-1;e--){for(s=0,r=!1;s<this.touches.length;s++)this.touches[s].obj.id===this.downObjects[e].id&&(r=!0);r||(this.downObjects[e].triggerEventHandlers(["touchup","up"],[t]),g.Z.exists(this.downObjects[e].coords)||(this.downObjects[e].snapToGrid(),this.downObjects[e].snapToPoints(),d=!0),this.downObjects.splice(e,1))}return(!u||0===u.length)&&(this.hasTouchEnd&&(m.Z.removeEvent(this.document,"touchend",this.touchEndListener,this),this.hasTouchEnd=!1),this.dehighlightAll(),this.updateQuality=this.BOARD_QUALITY_HIGH,this.originMoveEnd(),d&&this.update()),!0},mouseDownListener:function(t){var e,s,i;if(this.document.selection&&g.Z.isFunction(this.document.selection.empty)?this.document.selection.empty():window.getSelection&&window.getSelection().removeAllRanges(),!this.hasMouseUp){if(m.Z.addEvent(this.document,"mouseup",this.mouseUpListener,this),this.hasMouseUp=!0,this._inputDevice="mouse",this.options.precision.hasPoint=this.options.precision.mouse,e=this.getMousePosition(t),this._testForSelection(t),this.selectingMode){this._startSelecting(e),this.triggerEventHandlers(["mousestartselecting","startselecting"],[t]);return}return 0===(s=this.initMoveObject(e[0],e[1],t,"mouse")).length?(this.mode=this.BOARD_MODE_NONE,i=!0):(this.mouse={obj:null,targets:[{X:e[0],Y:e[1],Xprev:NaN,Yprev:NaN}]},this.mouse.obj=s[s.length-1],this.dehighlightAll(),this.mouse.obj.highlight(!0),this.mouse.targets[0].Xstart=[],this.mouse.targets[0].Ystart=[],this.mouse.targets[0].Zstart=[],this.saveStartPos(this.mouse.obj,this.mouse.targets[0]),t&&t.preventDefault?t.preventDefault():window.event&&(window.event.returnValue=!1)),this.mode===this.BOARD_MODE_NONE&&(i=this.mouseOriginMoveStart(t)),this.triggerEventHandlers(["mousedown","down"],[t]),i}},mouseMoveListener:function(t){var e;if(!this.checkFrameRate(t))return!1;e=this.getMousePosition(t),this.updateQuality=this.BOARD_QUALITY_LOW,this.mode!==this.BOARD_MODE_DRAG&&(this.dehighlightAll(),this.displayInfobox(!1)),this.selectingMode?(this._moveSelecting(e),this.triggerEventHandlers(["mousemoveselecting","moveselecting"],[t,this.mode])):this.mouseOriginMove(t)||(this.mode===this.BOARD_MODE_DRAG?this.moveObject(e[0],e[1],this.mouse,t,"mouse"):this.highlightElements(e[0],e[1],t,-1),this.triggerEventHandlers(["mousemove","move"],[t,this.mode])),this.updateQuality=this.BOARD_QUALITY_HIGH},mouseUpListener:function(t){var e;if(!1===this.selectingMode&&this.triggerEventHandlers(["mouseup","up"],[t]),this.updateQuality=this.BOARD_QUALITY_HIGH,this.mouse&&this.mouse.obj&&!g.Z.exists(this.mouse.obj.coords)&&(this.mouse.obj.snapToGrid(this.mouse.targets[0]),this.mouse.obj.snapToPoints()),this.originMoveEnd(),this.dehighlightAll(),this.update(),this.selectingMode)this._stopSelecting(t),this.triggerEventHandlers(["mousestopselecting","stopselecting"],[t]),this.stopSelectionMode();else for(e=0;e<this.downObjects.length;e++)this.downObjects[e].triggerEventHandlers(["mouseup","up"],[t]);this.downObjects.length=0,this.hasMouseUp&&(m.Z.removeEvent(this.document,"mouseup",this.mouseUpListener,this),this.hasMouseUp=!1),this.mouse=null},mouseWheelListener:function(t){if(!this.attr.zoom.enabled||!this.attr.zoom.wheel||!this._isRequiredKeyPressed(t,"zoom"))return!0;var e=(t=t||window.event).detail?-t.detail:t.wheelDelta/40,s=new n.Z(o.Z.COORDS_BY_SCREEN,this.getMousePosition(t),this);return e>0?this.zoomIn(s.usrCoords[1],s.usrCoords[2]):this.zoomOut(s.usrCoords[1],s.usrCoords[2]),this.triggerEventHandlers(["mousewheel"],[t]),t.preventDefault(),!1},keyDownListener:function(t){var e,s,n,r,h,a,c=t.target.id,l=0,u=0,d=g.Z.evaluate(this.attr.keyboard.dx)/this.unitX,p=g.Z.evaluate(this.attr.keyboard.dy)/this.unitY,v=!1,m=!0;return!!this.attr.keyboard.enabled&&""!==c&&(!(r=this.containerObj.shadowRoot||document).activeElement||"INPUT"!==(s=r.activeElement).tagName&&"textarea"!==s.tagName)&&(e=c.replace(this.containerObj.id+"_",""),s=this.select(e),g.Z.exists(s.coords)&&(a=s.coords.usrCoords.slice(1)),g.Z.evaluate(this.attr.keyboard.panshift)&&t.shiftKey||g.Z.evaluate(this.attr.keyboard.panctrl)&&t.ctrlKey?(!0===g.Z.evaluate(this.attr.zoom.enabled)&&(v=!0),38===t.keyCode?this.clickUpArrow():40===t.keyCode?this.clickDownArrow():37===t.keyCode?this.clickLeftArrow():39===t.keyCode?this.clickRightArrow():v&&171===t.keyCode?this.zoomIn():v&&173===t.keyCode?this.zoomOut():v&&79===t.keyCode?this.zoom100():m=!1):(g.Z.exists(s.visProp)&&(g.Z.exists(s.visProp.snaptogrid)&&s.visProp.snaptogrid&&g.Z.evaluate(s.visProp.snapsizex)&&g.Z.evaluate(s.visProp.snapsizey)?(l=(n=s.getSnapSizes())[0],u=n[1],d=l,p=u):g.Z.exists(s.visProp.attracttogrid)&&s.visProp.attracttogrid&&g.Z.evaluate(s.visProp.attractordistance)&&g.Z.evaluate(s.visProp.attractorunit)&&(u=l=1.1*g.Z.evaluate(s.visProp.attractordistance),"screen"===g.Z.evaluate(s.visProp.attractorunit)&&(l/=this.unitX,u/=this.unitX),d=Math.max(l,d),p=Math.max(u,p))),38===t.keyCode?h=[0,p]:40===t.keyCode?h=[0,-p]:37===t.keyCode?h=[-d,0]:39===t.keyCode?h=[d,0]:m=!1,h&&s.isDraggable&&s.visPropCalc.visible&&(this.geonextCompatibilityMode&&(g.Z.isPoint(s)||s.elementClass===o.Z.OBJECT_CLASS_TEXT)||!this.geonextCompatibilityMode)&&!g.Z.evaluate(s.visProp.fixed)&&(this.mode=this.BOARD_MODE_DRAG,g.Z.exists(s.coords)&&(h[0]+=a[0],h[1]+=a[1]),g.Z.exists(s.coords)?(s.setPosition(i.Z.COORDS_BY_USER,h),this.updateInfobox(s)):(this.displayInfobox(!1),s.setPositionDirectly(o.Z.COORDS_BY_USER,h,[0,0])),this.triggerEventHandlers(["keymove","move"],[t,this.mode]),s.triggerEventHandlers(["keydrag","drag"],[t]),this.mode=this.BOARD_MODE_NONE)),this.update(),m&&g.Z.exists(t.preventDefault)&&t.preventDefault(),m)},keyFocusInListener:function(t){var e,s,i=t.target.id;if(!this.attr.keyboard.enabled||""===i)return!1;e=i.replace(this.containerObj.id+"_",""),s=this.select(e),g.Z.exists(s.highlight)&&(s.highlight(!0),this.focusObjects=[e],s.triggerEventHandlers(["hit"],[t])),g.Z.exists(s.coords)&&this.updateInfobox(s)},keyFocusOutListener:function(t){if(!this.attr.keyboard.enabled)return!1;this.focusObjects=[],this.dehighlightAll(),this.displayInfobox(!1)},updateContainerDims:function(){var t,e,s,i,o,n;t=(s=this.containerObj.getBoundingClientRect()).width,e=s.height,window&&window.getComputedStyle&&(isNaN(o=parseFloat((i=window.getComputedStyle(this.containerObj,null)).getPropertyValue("border-left-width"))+parseFloat(i.getPropertyValue("border-right-width")))||(t-=o),isNaN(n=parseFloat(i.getPropertyValue("border-top-width"))+parseFloat(i.getPropertyValue("border-bottom-width")))||(e-=n)),!(t<=0||e<=0||isNaN(t)||isNaN(e))&&(isNaN(this.getBoundingBox()[0])&&this.setBoundingBox(this.attr.boundingbox,this.keepaspectratio,"keep"),g.Z.exists(this._prevDim)&&this._prevDim.w===t&&this._prevDim.h===e||(this.resizeContainer(t,e,!0),this._prevDim={w:t,h:e}))},startResizeObserver:function(){var t=this;m.Z.isBrowser&&this.attr.resize&&this.attr.resize.enabled&&(this.resizeObserver=new ResizeObserver(function(e){t._isResizing||(t._isResizing=!0,window.setTimeout(function(){try{t.updateContainerDims()}catch(e){t.stopResizeObserver()}finally{t._isResizing=!1}},t.attr.resize.throttle))}),this.resizeObserver.observe(this.containerObj))},stopResizeObserver:function(){m.Z.isBrowser&&this.attr.resize&&this.attr.resize.enabled&&g.Z.exists(this.resizeObserver)&&this.resizeObserver.unobserve(this.containerObj)},resizeListener:function(){var t=this;m.Z.isBrowser&&this.attr.resize&&this.attr.resize.enabled&&(this._isScrolling||this._isResizing||(this._isResizing=!0,window.setTimeout(function(){t.updateContainerDims(),t._isResizing=!1},this.attr.resize.throttle)))},scrollListener:function(t){var e=this;m.Z.isBrowser&&(this._isScrolling||(this._isScrolling=!0,window.setTimeout(function(){e._isScrolling=!1},66)))},startIntersectionObserver:function(){var t=this;try{this.intersectionObserver=new IntersectionObserver(function(e){isNaN(t.getBoundingBox()[0])&&t.updateContainerDims()},{root:null,rootMargin:"0px",threshold:.8}),this.intersectionObserver.observe(t.containerObj)}catch(t){i.Z.debug("JSXGraph: IntersectionObserver not available in this browser.")}},stopIntersectionObserver:function(){g.Z.exists(this.intersectionObserver)&&this.intersectionObserver.unobserve(this.containerObj)},initInfobox:function(t){var e=g.Z.copyAttributes(t,this.options,"infobox");return e.id=this.id+"_infobox",this.infobox=this.create("text",[0,0,"0,0"],e),this.infobox.dump=!1,this.displayInfobox(!1),this},updateInfobox:function(t){var e,s,i,o,n,r,h,a=g.Z.evaluate(t.visProp.showinfobox);return(g.Z.evaluate(this.attr.showinfobox)||"inherit"!==a)&&a&&g.Z.isPoint(t)&&(i=t.coords.usrCoords[1],o=t.coords.usrCoords[2],r=g.Z.evaluate(this.infobox.visProp.distancex),h=g.Z.evaluate(this.infobox.visProp.distancey),this.infobox.setCoords(i+r/this.unitX,o+h/this.unitY),n=g.Z.evaluate(t.visProp.infoboxdigits),"string"!=typeof t.infoboxText?("auto"===n?this.infobox.useLocale()?(e=this.infobox.formatNumberLocale(i),s=this.infobox.formatNumberLocale(o)):(e=g.Z.autoDigits(i),s=g.Z.autoDigits(o)):g.Z.isNumber(n)?this.infobox.useLocale()?(e=this.infobox.formatNumberLocale(i,n),s=this.infobox.formatNumberLocale(o,n)):(e=g.Z.toFixed(i,n),s=g.Z.toFixed(o,n)):(e=i,s=o),this.highlightInfobox(e,s,t)):this.highlightCustomInfobox(t.infoboxText,t),this.displayInfobox(!0)),this},displayInfobox:function(t){return!t&&this.focusObjects.length>0&&this.select(this.focusObjects[0]).elementClass===o.Z.OBJECT_CLASS_POINT||this.infobox.hiddenByParent===t&&(this.infobox.hiddenByParent=!t,this.infobox.prepareUpdate().updateVisibility(t).updateRenderer()),this},showInfobox:function(t){return this.displayInfobox(t)},highlightInfobox:function(t,e,s){return this.highlightCustomInfobox("("+t+", "+e+")",s),this},highlightCustomInfobox:function(t,e){return this.infobox.setText(t),this},dehighlightAll:function(){var t,e,s={},i=!1;for(t in this.highlightedObjects)this.highlightedObjects.hasOwnProperty(t)&&(e=this.highlightedObjects[t],0>this.focusObjects.indexOf(t)?((this.hasMouseHandlers||this.hasPointerHandlers)&&e.noHighlight(),i=!0):s[t]=e);return this.highlightedObjects=s,"canvas"===this.renderer.type&&i&&(this.prepareUpdate(),this.renderer.suspendRedraw(this),this.updateRenderer(),this.renderer.unsuspendRedraw()),this},getScrCoordsOfMouse:function(t,e){return[t,e]},getUsrCoordsOfMouse:function(t){var e=this.getCoordsTopLeftCorner(),s=m.Z.getPosition(t,null,this.document),i=s[0]-e[0],r=s[1]-e[1];return new n.Z(o.Z.COORDS_BY_SCREEN,[i,r],this).usrCoords.slice(1)},getAllUnderMouse:function(t){var e=this.getAllObjectsUnderMouse(t);return e.push(this.getUsrCoordsOfMouse(t)),e},getAllObjectsUnderMouse:function(t){var e,s,i=this.getCoordsTopLeftCorner(),o=m.Z.getPosition(t,null,this.document),n=o[0]-i[0],r=o[1]-i[1],h=[],a=this.objectsList.length;for(e=0;e<a;e++)(s=this.objectsList[e]).visPropCalc.visible&&s.hasPoint&&s.hasPoint(n,r)&&(h[h.length]=s);return h},updateCoords:function(){var t,e,s=this.objectsList.length;for(e=0;e<s;e++)t=this.objectsList[e],g.Z.exists(t.coords)&&(g.Z.evaluate(t.visProp.frozen)?t.is3D?t.element2D.coords.screen2usr():t.coords.screen2usr():t.is3D?t.element2D.coords.usr2screen():t.coords.usr2screen());return this},moveOrigin:function(t,e,s){var i,r,h,a;return g.Z.exists(t)&&g.Z.exists(e)&&(i=this.origin.scrCoords[1],r=this.origin.scrCoords[2],this.origin.scrCoords[1]=t,this.origin.scrCoords[2]=e,s&&(this.origin.scrCoords[1]-=this.drag_dx,this.origin.scrCoords[2]-=this.drag_dy),h=new n.Z(o.Z.COORDS_BY_SCREEN,[0,0],this).usrCoords,a=new n.Z(o.Z.COORDS_BY_SCREEN,[this.canvasWidth,this.canvasHeight],this).usrCoords,(h[1]<this.maxboundingbox[0]||h[2]>this.maxboundingbox[1]||a[1]>this.maxboundingbox[2]||a[2]<this.maxboundingbox[3])&&(this.origin.scrCoords[1]=i,this.origin.scrCoords[2]=r)),this.updateCoords().clearTraces().fullUpdate(),this.triggerEventHandlers(["boundingbox"]),this},addConditions:function(t){var e,s,n,r,h,a,c,l=[],u=t.indexOf("<data>"),d=t.indexOf("</data>"),v=function(t,e,s,i){return function(){var n,r;r=(n=t.select(e.id)).coords.usrCoords[i],2===i?n.setPositionDirectly(o.Z.COORDS_BY_USER,[s(),r]):n.setPositionDirectly(o.Z.COORDS_BY_USER,[r,s()]),n.prepareUpdate().update()}},m=function(t,e,s){return function(){var i,o;i=t.select(e.id),o=s(),i.setAttribute({visible:o})}},f=function(t,e,s,i){return function(){var o,n;o=t.select(e.id),n=s(),"strokewidth"===i?o.visProp.strokewidth=n:(n=p.Z.rgba2rgbo(n),o.visProp[i+"color"]=n[0],o.visProp[i+"opacity"]=n[1])}},b=function(t,e,s){return function(){t.select(e.id).position=s()}},_=function(t,e,s){return function(){t.select(e.id).setStyle(s())}};if(!(u<0)){for(;u>=0;){if(s=(e=t.slice(u+6,d)).indexOf("="),n=e.slice(0,s),r=e.slice(s+1),s=n.indexOf("."),h=n.slice(0,s),a=this.elementsByName[g.Z.unescapeHTML(h)],c=n.slice(s+1).replace(/\s+/g,"").toLowerCase(),r=g.Z.createFunction(r,this,"",!0),g.Z.exists(this.elementsByName[h]))switch(c){case"x":l.push(v(this,a,r,2));break;case"y":l.push(v(this,a,r,1));break;case"visible":l.push(m(this,a,r));break;case"position":l.push(b(this,a,r));break;case"stroke":l.push(f(this,a,r,"stroke"));break;case"style":l.push(_(this,a,r));break;case"strokewidth":l.push(f(this,a,r,"strokewidth"));break;case"fill":l.push(f(this,a,r,"fill"));break;case"label":break;default:i.Z.debug('property "'+c+'" in conditions not yet implemented:'+r)}else i.Z.debug("debug conditions: |"+h+"| undefined");u=(t=t.slice(d+7)).indexOf("<data>"),d=t.indexOf("</data>")}this.updateConditions=function(){var t;for(t=0;t<l.length;t++)l[t]();return this.prepareUpdate().updateElements(),!0},this.updateConditions()}},updateConditions:function(){return!1},calculateSnapSizes:function(){var t=new n.Z(o.Z.COORDS_BY_USER,[0,0],this),e=new n.Z(o.Z.COORDS_BY_USER,[this.options.grid.gridX,this.options.grid.gridY],this),s=t.scrCoords[1]-e.scrCoords[1],i=t.scrCoords[2]-e.scrCoords[2];for(this.options.grid.snapSizeX=this.options.grid.gridX;Math.abs(s)>25;)this.options.grid.snapSizeX*=2,s/=2;for(this.options.grid.snapSizeY=this.options.grid.gridY;Math.abs(i)>25;)this.options.grid.snapSizeY*=2,i/=2;return this},applyZoom:function(){return this.updateCoords().calculateSnapSizes().clearTraces().fullUpdate(),this},zoomIn:function(t,e){var s=this.getBoundingBox(),i=this.attr.zoom.factorx,o=this.attr.zoom.factory,n=(s[2]-s[0])*(1-1/i),r=(s[1]-s[3])*(1-1/o),h=.5,a=.5,c=this.attr.zoom.eps||this.attr.zoom.min||.001;return this.zoomX>this.attr.zoom.max&&i>1||this.zoomY>this.attr.zoom.max&&o>1||this.zoomX<c&&i<1||this.zoomY<c&&o<1?this:(g.Z.isNumber(t)&&g.Z.isNumber(e)&&(h=(t-s[0])/(s[2]-s[0]),a=(s[1]-e)/(s[1]-s[3])),this.setBoundingBox([s[0]+n*h,s[1]-r*a,s[2]-n*(1-h),s[3]+r*(1-a)],this.keepaspectratio,"update"),this.applyZoom())},zoomOut:function(t,e){var s=this.getBoundingBox(),i=this.attr.zoom.factorx,o=this.attr.zoom.factory,n=(s[2]-s[0])*(1-i),r=(s[1]-s[3])*(1-o),h=.5,a=.5,c=this.attr.zoom.eps||this.attr.zoom.min||.001;return this.zoomX<c||this.zoomY<c?this:(g.Z.isNumber(t)&&g.Z.isNumber(e)&&(h=(t-s[0])/(s[2]-s[0]),a=(s[1]-e)/(s[1]-s[3])),this.setBoundingBox([s[0]+n*h,s[1]-r*a,s[2]-n*(1-h),s[3]+r*(1-a)],this.keepaspectratio,"update"),this.applyZoom())},zoom100:function(){var t,e,s;return g.Z.exists(this.attr.boundingbox)?this.setBoundingBox(this.attr.boundingbox,this.keepaspectratio,"reset"):(e=((t=this.getBoundingBox())[2]-t[0])*(1-this.zoomX)*.5,s=(t[1]-t[3])*(1-this.zoomY)*.5,this.setBoundingBox([t[0]+e,t[1]-s,t[2]-e,t[3]+s],this.keepaspectratio,"reset")),this.applyZoom()},zoomAllPoints:function(){var t,e,s,i,o=0,n=0,r=0,h=0,a=this.objectsList.length;for(t=0;t<a;t++)i=this.objectsList[t],g.Z.isPoint(i)&&i.visPropCalc.visible&&(i.coords.usrCoords[1]<o?o=i.coords.usrCoords[1]:i.coords.usrCoords[1]>n&&(n=i.coords.usrCoords[1]),i.coords.usrCoords[2]>h?h=i.coords.usrCoords[2]:i.coords.usrCoords[2]<r&&(r=i.coords.usrCoords[2]));return e=50/this.unitX,s=50/this.unitY,this.setBoundingBox([o-e,h+s,n+e,r-s],this.keepaspectratio,"update"),this.applyZoom()},zoomElements:function(t){var e,s,i,o,n,r=[1/0,-1/0,-1/0,1/0];if(!g.Z.isArray(t)||0===t.length)return this;for(e=0;e<t.length;e++)s=this.select(t[e]).bounds(),g.Z.isArray(s)&&(s[0]<r[0]&&(r[0]=s[0]),s[1]>r[1]&&(r[1]=s[1]),s[2]>r[2]&&(r[2]=s[2]),s[3]<r[3]&&(r[3]=s[3]));return g.Z.isArray(r)&&(i=.5*(r[0]+r[2]),o=.5*(r[1]+r[3]),n=Math.max(1.5*(r[2]-r[0])*.5,1.5*(r[1]-r[3])*.5),this.setBoundingBox([i-n,o+n,i+n,o-n],this.keepaspectratio,"update")),this},setZoom:function(t,e){var s=this.attr.zoom.factorx,i=this.attr.zoom.factory;return this.attr.zoom.factorx=t/this.zoomX,this.attr.zoom.factory=e/this.zoomY,this.zoomIn(),this.attr.zoom.factorx=s,this.attr.zoom.factory=i,this},_removeObj:function(t,e){var s,n;if(g.Z.isArray(t)){for(n=0;n<t.length;n++)this._removeObj(t[n],e);return this}if(t=this.select(t),!g.Z.exists(t)||g.Z.isString(t))return this;try{for(s in t.childElements)t.childElements.hasOwnProperty(s)&&t.childElements[s].board._removeObj(t.childElements[s]);for(s in t.objects)t.objects.hasOwnProperty(s)&&t.objects[s].board._removeObj(t.objects[s]);if(e)for(s in this.objects)this.objects.hasOwnProperty(s)&&g.Z.exists(this.objects[s].childElements)&&g.Z.exists(this.objects[s].childElements.hasOwnProperty(t.id))&&(delete this.objects[s].childElements[t.id],delete this.objects[s].descendants[t.id]);else if(g.Z.exists(t.ancestors))for(s in t.ancestors)t.ancestors.hasOwnProperty(s)&&g.Z.exists(t.ancestors[s].childElements)&&g.Z.exists(t.ancestors[s].childElements.hasOwnProperty(t.id))&&(delete t.ancestors[s].childElements[t.id],delete t.ancestors[s].descendants[t.id]);if(t._pos>-1)for(this.objectsList.splice(t._pos,1),n=t._pos;n<this.objectsList.length;n++)this.objectsList[n]._pos--;else t.type!==o.Z.OBJECT_TYPE_TURTLE&&i.Z.debug("Board.removeObject: object "+t.id+" not found in list.");delete this.objects[t.id],delete this.elementsByName[t.name],t.visProp&&g.Z.evaluate(t.visProp.trace)&&t.clearTrace(),g.Z.exists(t.remove)&&t.remove()}catch(e){i.Z.debug(t.id+": Could not be removed: "+e)}return this},removeObject:function(t,e){var s;if(this.renderer.suspendRedraw(this),g.Z.isArray(t))for(s=0;s<t.length;s++)this._removeObj(t[s],e);else this._removeObj(t,e);return this.renderer.unsuspendRedraw(),this.update(),this},removeAncestors:function(t){var e;for(e in t.ancestors)t.ancestors.hasOwnProperty(e)&&this.removeAncestors(t.ancestors[e]);return this.removeObject(t),this},initGeonextBoard:function(){var t,e,s;return t=this.create("point",[0,0],{id:this.id+"g00e0",name:"Ursprung",withLabel:!1,visible:!1,fixed:!0}),e=this.create("point",[1,0],{id:this.id+"gX0e0",name:"Punkt_1_0",withLabel:!1,visible:!1,fixed:!0}),s=this.create("point",[0,1],{id:this.id+"gY0e0",name:"Punkt_0_1",withLabel:!1,visible:!1,fixed:!0}),this.create("line",[t,e],{id:this.id+"gXLe0",name:"X-Achse",withLabel:!1,visible:!1}),this.create("line",[t,s],{id:this.id+"gYLe0",name:"Y-Achse",withLabel:!1,visible:!1}),this},resizeContainer:function(t,e,s,i){var o,n,r,h,c;return n=this.canvasWidth,r=this.canvasHeight,i||(o=this.getBoundingBox()),this.canvasWidth=Math.max(parseFloat(t),a.Z.eps),this.canvasHeight=Math.max(parseFloat(e),a.Z.eps),s||(this.containerObj.style.width=this.canvasWidth+"px",this.containerObj.style.height=this.canvasHeight+"px"),this.renderer.resize(this.canvasWidth,this.canvasHeight),i?(h=(this.canvasWidth-n)/2,c=(this.canvasHeight-r)/2,this.moveOrigin(this.origin.scrCoords[1]+h,this.origin.scrCoords[2]+c)):this.setBoundingBox(o,this.keepaspectratio,"keep"),this},showDependencies:function(){var t,e,s,i,o;for(t in e="<p>\n",this.objects)if(this.objects.hasOwnProperty(t)){for(s in o=0,this.objects[t].childElements)this.objects[t].childElements.hasOwnProperty(s)&&(o+=1);for(s in o>=0&&(e+="<strong>"+this.objects[t].id+":</strong> "),this.objects[t].childElements)this.objects[t].childElements.hasOwnProperty(s)&&(e+=this.objects[t].childElements[s].id+"("+this.objects[t].childElements[s].name+"), ");e+="<p>\n"}return e+="</p>\n",(i=window.open()).document.open(),i.document.write(e),i.document.close(),this},showXML:function(){var t=window.open("");return t.document.open(),t.document.write("<pre>"+g.Z.escapeHTML(this.xmlString)+"</pre>"),t.document.close(),this},prepareUpdate:function(){var t,e,s=this.objectsList.length;for(t=0;t<s;t++)(e=this.objectsList[t]).needsUpdate=e.needsRegularUpdate||this.needsFullUpdate;for(t in this.groups)this.groups.hasOwnProperty(t)&&((e=this.groups[t]).needsUpdate=e.needsRegularUpdate||this.needsFullUpdate);return this},updateElements:function(t){var e,s;for(e=0,t=this.select(t);e<this.objectsList.length;e++)s=this.objectsList[e],this.needsFullUpdate&&s.elementClass===o.Z.OBJECT_CLASS_TEXT&&s.updateSize(),s.update(!g.Z.exists(t)||s.id!==t.id).updateVisibility();for(e in this.groups)this.groups.hasOwnProperty(e)&&this.groups[e].update(t);return this},updateRenderer:function(){var t,e=this.objectsList.length;if(this.renderer){if("canvas"===this.renderer.type)this.updateRendererCanvas();else for(t=0;t<e;t++)this.objectsList[t].updateRenderer();return this}},updateRendererCanvas:function(){var t,e,s,i,o,n=this.objectsList.length,r=this.options.layer,h=this.options.layer.numlayers,a=Number.NEGATIVE_INFINITY;for(s=0;s<h;s++){for(o in i=Number.POSITIVE_INFINITY,r)r.hasOwnProperty(o)&&r[o]>a&&r[o]<i&&(i=r[o]);for(t=0,a=i;t<n;t++)(e=this.objectsList[t]).visProp.layer===i&&e.prepareUpdate().updateRenderer()}return this},addHook:function(t,e,s){return i.Z.deprecated("Board.addHook()","Board.on()"),e=g.Z.def(e,"update"),s=g.Z.def(s,this),this.hooks.push([e,t]),this.on(e,t,s),this.hooks.length-1},addEvent:i.Z.shortcut(i.Z.Board.prototype,"on"),removeHook:function(t){return i.Z.deprecated("Board.removeHook()","Board.off()"),this.hooks[t]&&(this.off(this.hooks[t][0],this.hooks[t][1]),this.hooks[t]=null),this},removeEvent:i.Z.shortcut(i.Z.Board.prototype,"off"),updateHooks:function(t){var e=Array.prototype.slice.call(arguments,0);return i.Z.deprecated("Board.updateHooks()","Board.triggerEventHandlers()"),e[0]=g.Z.def(e[0],"update"),this.triggerEventHandlers([e[0]],arguments),this},addChild:function(t){return g.Z.exists(t)&&g.Z.exists(t.containerObj)&&(this.dependentBoards.push(t),this.update()),this},removeChild:function(t){var e;for(e=this.dependentBoards.length-1;e>=0;e--)this.dependentBoards[e]===t&&this.dependentBoards.splice(e,1);return this},update:function(t){var e,s,i,o,n;if(this.inUpdate||this.isSuspendedUpdate)return this;for(this.inUpdate=!0,"all"===this.attr.minimizereflow&&this.containerObj&&"vml"!==this.renderer.type&&(n=this.document.activeElement,o=this.renderer.removeToInsertLater(this.containerObj)),"svg"===this.attr.minimizereflow&&"svg"===this.renderer.type&&(n=this.document.activeElement,o=this.renderer.removeToInsertLater(this.renderer.svgRoot)),this.prepareUpdate().updateElements(t).updateConditions(),this.renderer.suspendRedraw(this),this.updateRenderer(),this.renderer.unsuspendRedraw(),this.triggerEventHandlers(["update"],[]),o&&(o(),n.focus()),s=this.dependentBoards.length,e=0;e<s;e++)i=this.dependentBoards[e],g.Z.exists(i)&&i!==this&&(i.updateQuality=this.updateQuality,i.prepareUpdate().updateElements().updateConditions(),i.renderer.suspendRedraw(this),i.updateRenderer(),i.renderer.unsuspendRedraw(),i.triggerEventHandlers(["update"],[]));return this.inUpdate=!1,this},fullUpdate:function(){return this.needsFullUpdate=!0,this.update(),this.needsFullUpdate=!1,this},addGrid:function(){return this.create("grid",[]),this},removeGrids:function(){var t;for(t=0;t<this.grids.length;t++)this.removeObject(this.grids[t]);return this.grids.length=0,this.update(),this},create:function(t,e,s){var o,n;for(t=t.toLowerCase(),g.Z.exists(e)||(e=[]),g.Z.exists(s)||(s={}),n=0;n<e.length;n++)g.Z.isString(e[n])&&("text"!==t||2!==n)&&("solidofrevolution3d"!==t||2!==n)&&("input"!==t&&"checkbox"!==t&&"button"!==t||2!==n&&3!==n)&&"curve"!==t&&"functiongraph"!==t&&(e[n]=this.select(e[n]));if(g.Z.isFunction(i.Z.elements[t]))o=i.Z.elements[t](this,e,s);else throw Error("JSXGraph: create: Unknown element type given: "+t);return g.Z.exists(o)?o.prepareUpdate&&o.update&&o.updateRenderer&&o.fullUpdate():i.Z.debug("JSXGraph: create: failure creating "+t),o},createElement:function(){return i.Z.deprecated("Board.createElement()","Board.create()"),this.create.apply(this,arguments)},clearTraces:function(){var t;for(t=0;t<this.objectsList.length;t++)this.objectsList[t].clearTrace();return this.numTraces=0,this},suspendUpdate:function(){return this.inUpdate||(this.isSuspendedUpdate=!0),this},unsuspendUpdate:function(){return this.isSuspendedUpdate&&(this.isSuspendedUpdate=!1,this.fullUpdate()),this},setBoundingBox:function(t,e,s){var i,o,n,r,h,c,l,u,d,p=0,v=0,f=1,b=m.Z.getDimensions(this.container,this.document);return!g.Z.isArray(t)||t[0]<this.maxboundingbox[0]||t[1]>this.maxboundingbox[1]||t[2]>this.maxboundingbox[2]||t[3]<this.maxboundingbox[3]||(g.Z.exists(s)||(s="reset"),n=this.unitX,r=this.unitY,this.canvasWidth=parseFloat(b.width),this.canvasHeight=parseFloat(b.height),o=this.canvasWidth,i=this.canvasHeight,e?(h=n/r,"keep"===s&&(f=this.zoomX/this.zoomY),c=t[2]-t[0],l=t[1]-t[3],u=n*c,d=r*l,o>=i?(u>=d?this.unitY=i/l:this.unitY=i/Math.abs(c)*a.Z.sign(l)/f,this.unitX=this.unitY*h):(d>u?this.unitX=o/c:this.unitX=o/Math.abs(l)*a.Z.sign(c)*f,this.unitY=this.unitX/h),p=(o/this.unitX-c)*.5,v=(i/this.unitY-l)*.5,this.keepaspectratio=!0):(this.unitX=o/(t[2]-t[0]),this.unitY=i/(t[1]-t[3]),this.keepaspectratio=!1),this.moveOrigin(-this.unitX*(t[0]-p),this.unitY*(t[1]+v)),"update"===s?(this.zoomX*=this.unitX/n,this.zoomY*=this.unitY/r):"reset"===s&&(this.zoomX=g.Z.exists(this.attr.zoomx)?this.attr.zoomx:1,this.zoomY=g.Z.exists(this.attr.zoomy)?this.attr.zoomy:1)),this},getBoundingBox:function(){var t=new n.Z(o.Z.COORDS_BY_SCREEN,[0,0],this).usrCoords,e=new n.Z(o.Z.COORDS_BY_SCREEN,[this.canvasWidth,this.canvasHeight],this).usrCoords;return[t[1],t[2],e[1],e[2]]},_set:function(t,e){t=t.toLocaleLowerCase(),null!==e&&g.Z.isObject(e)&&!g.Z.exists(e.id)&&!g.Z.exists(e.name)?g.Z.mergeAttr(this.attr[t],e):this.attr[t]=e},setAttribute:function(t){var e,s,n,r,h,a,c,l={};for(e=0;e<arguments.length;e++)s=arguments[e],g.Z.isString(s)?(n=s.split(":"),l[g.Z.trim(n[0])]=g.Z.trim(n[1])):g.Z.isArray(s)?l[s[0]]=s[1]:i.Z.extend(l,s);for(e in l)switch(l.hasOwnProperty(e)&&(r=e.replace(/\s+/g,"").toLowerCase(),h=l[e]),h=(!h.toLowerCase||"false"!==h.toLowerCase())&&h,a=this.attr[r],r){case"axis":!1===h&&g.Z.exists(this.defaultAxes)&&(this.defaultAxes.x.setAttribute({visible:!1}),this.defaultAxes.y.setAttribute({visible:!1}));break;case"boundingbox":this.setBoundingBox(h,this.keepaspectratio),this._set(r,h);break;case"defaultaxes":g.Z.exists(this.defaultAxes.x)&&g.Z.exists(h.x)&&this.defaultAxes.x.setAttribute(h.x),g.Z.exists(this.defaultAxes.y)&&g.Z.exists(h.y)&&this.defaultAxes.y.setAttribute(h.y);break;case"description":this.document.getElementById(this.container+"_ARIAdescription").innerHTML=h,this._set(r,h);break;case"title":this.document.getElementById(this.container+"_ARIAlabel").innerHTML=h,this._set(r,h);break;case"keepaspectratio":this._set(r,h),a=this.getBoundingBox(),this.setBoundingBox([0,this.canvasHeight,this.canvasWidth,0],!1,"keep"),this.setBoundingBox(a,h,"keep");break;case"document":case"maxboundingbox":this[r]=h,this._set(r,h);break;case"zoomx":case"zoomy":this[r]=h,this._set(r,h),this.setZoom(this.attr.zoomx,this.attr.zoomy);break;case"registerevents":case"renderer":break;case"fullscreen":case"screenshot":(c=this.containerObj.ownerDocument.getElementById(this.container+"_navigation_"+r))&&g.Z.exists(h.symbol)&&(c.innerHTML=g.Z.evaluate(h.symbol)),this._set(r,h);break;case"selection":h.visible=!1,h.withLines=!1,h.vertices={visible:!1},this._set(r,h);break;case"showcopyright":"svg"===this.renderer.type&&((c=this.containerObj.ownerDocument.getElementById(this.renderer.uniqName("licenseText")))?c.style.display=g.Z.evaluate(h)?"inline":"none":g.Z.evaluate(h)&&this.renderer.displayCopyright(o.Z.licenseText,parseInt(this.options.text.fontSize,10)));default:g.Z.exists(this.attr[r])&&this._set(r,h)}return this.containerObj.ownerDocument.getElementById(this.container+"_navigationbar").remove(),this.renderer.drawNavigationBar(this,this.attr.navbar),this.triggerEventHandlers(["attribute"],[l,this]),this.fullUpdate(),this},addAnimation:function(t){var e=this;return this.animationObjects[t.id]=t,this.animationIntervalCode||(this.animationIntervalCode=window.setInterval(function(){e.animate()},t.board.attr.animationdelay)),this},stopAllAnimation:function(){var t;for(t in this.animationObjects)this.animationObjects.hasOwnProperty(t)&&g.Z.exists(this.animationObjects[t])&&(this.animationObjects[t]=null,delete this.animationObjects[t]);return window.clearInterval(this.animationIntervalCode),delete this.animationIntervalCode,this},animate:function(){var t,e,s,i,n,r,h,a,c=0,l=null;for(e in this.animationObjects)if(this.animationObjects.hasOwnProperty(e)&&g.Z.exists(this.animationObjects[e])){if(c+=1,(s=this.animationObjects[e]).animationPath&&(i=g.Z.isFunction(s.animationPath)?s.animationPath(new Date().getTime()-s.animationStart):s.animationPath.pop(),!g.Z.exists(i)||!g.Z.isArray(i)&&isNaN(i)?delete s.animationPath:(s.setPositionDirectly(o.Z.COORDS_BY_USER,i),s.fullUpdate(),l=s)),s.animationData){for(n in h=0,s.animationData)s.animationData.hasOwnProperty(n)&&(r=s.animationData[n].pop(),g.Z.exists(r)?(h+=1,(t={})[n]=r,s.setAttribute(t)):delete s.animationData[r]);0===h&&delete s.animationData}g.Z.exists(s.animationData)||g.Z.exists(s.animationPath)||(this.animationObjects[e]=null,delete this.animationObjects[e],g.Z.exists(s.animationCallback)&&(a=s.animationCallback,s.animationCallback=null,a()))}return 0===c?(window.clearInterval(this.animationIntervalCode),delete this.animationIntervalCode):this.update(l),this},migratePoint:function(t,e,s){var i,o,n,r,h,a,c=!1;for(o in t=this.select(t),e=this.select(e),g.Z.exists(t.label)&&(a=t.label.id,c=!0,this.removeObject(t.label)),t.childElements)if(t.childElements.hasOwnProperty(o)){for(n in i=t.childElements[o],r=!1,i)i.hasOwnProperty(n)&&i[n]===t&&(i[n]=e,r=!0);for(r&&delete t.childElements[o],h=0;h<i.parents.length;h++)i.parents[h]===t.id&&(i.parents[h]=e.id);e.addChild(i)}return s&&(c&&(delete e.childElements[a],delete e.descendants[a]),e.label&&this.removeObject(e.label),delete this.elementsByName[e.name],e.name=t.name,c&&e.createLabel()),this.removeObject(t),g.Z.exists(e.name)&&""!==e.name&&(this.elementsByName[e.name]=e),this.fullUpdate(),this},emulateColorblindness:function(t){var e,s;if(g.Z.exists(t)||(t="none"),this.currentCBDef===t)return this;for(e in this.objects)this.objects.hasOwnProperty(e)&&(s=this.objects[e],"none"!==t?("none"===this.currentCBDef&&(s.visPropOriginal={strokecolor:s.visProp.strokecolor,fillcolor:s.visProp.fillcolor,highlightstrokecolor:s.visProp.highlightstrokecolor,highlightfillcolor:s.visProp.highlightfillcolor}),s.setAttribute({strokecolor:p.Z.rgb2cb(g.Z.evaluate(s.visPropOriginal.strokecolor),t),fillcolor:p.Z.rgb2cb(g.Z.evaluate(s.visPropOriginal.fillcolor),t),highlightstrokecolor:p.Z.rgb2cb(g.Z.evaluate(s.visPropOriginal.highlightstrokecolor),t),highlightfillcolor:p.Z.rgb2cb(g.Z.evaluate(s.visPropOriginal.highlightfillcolor),t)})):g.Z.exists(s.visPropOriginal)&&i.Z.extend(s.visProp,s.visPropOriginal));return this.currentCBDef=t,this.update(),this},select:function(t,e){var s,i,o,n,r=t;if(null===r)return r;if(g.Z.isString(r)&&""!==r)g.Z.exists(this.objects[r])?r=this.objects[r]:g.Z.exists(this.elementsByName[r])?r=this.elementsByName[r]:g.Z.exists(this.groups[r])&&(r=this.groups[r]);else if(!e&&(g.Z.isFunction(r)||g.Z.isObject(r)&&!g.Z.isFunction(r.setAttribute))){for(o=0,s=g.Z.filterElements(this.objectsList,r),i={},n=s.length;o<n;o++)i[s[o].id]=s[o];r=new f.Z(i)}else g.Z.isObject(r)&&g.Z.exists(r.id)&&!g.Z.exists(this.objects[r.id])&&(r=null);return r},hasPoint:function(t,e){var s=t,i=e,o=this.getBoundingBox();return g.Z.exists(t)&&g.Z.isArray(t.usrCoords)&&(s=t.usrCoords[1],i=t.usrCoords[2]),!!(g.Z.isNumber(s)&&g.Z.isNumber(i)&&o[0]<s&&s<o[2]&&o[1]>i&&i>o[3])},updateCSSTransforms:function(){var t=this.containerObj,e=t,s=t;if(this.cssTransMat=m.Z.getCSSTransformMatrix(e),g.Z.exists(e.getRootNode)){for(e=e.parentNode===e.getRootNode()?e.parentNode.host:e.parentNode;e;)this.cssTransMat=a.Z.matMatMult(m.Z.getCSSTransformMatrix(e),this.cssTransMat),e=e.parentNode===e.getRootNode()?e.parentNode.host:e.parentNode;this.cssTransMat=a.Z.inverse(this.cssTransMat)}else{for(e=e.offsetParent;e;){for(this.cssTransMat=a.Z.matMatMult(m.Z.getCSSTransformMatrix(e),this.cssTransMat),s=s.parentNode;s!==e;)this.cssTransMat=a.Z.matMatMult(m.Z.getCSSTransformMatrix(e),this.cssTransMat),s=s.parentNode;e=e.offsetParent}this.cssTransMat=a.Z.inverse(this.cssTransMat)}return this},startSelectionMode:function(){this.selectingMode=!0,this.selectionPolygon.setAttribute({visible:!0}),this.selectingBox=[[0,0],[0,0]],this._setSelectionPolygonFromBox(),this.selectionPolygon.fullUpdate()},stopSelectionMode:function(){return this.selectingMode=!1,this.selectionPolygon.setAttribute({visible:!1}),[this.selectionPolygon.vertices[0].coords,this.selectionPolygon.vertices[2].coords]},_startSelecting:function(t){this.isSelecting=!0,this.selectingBox=[[t[0],t[1]],[t[0],t[1]]],this._setSelectionPolygonFromBox()},_moveSelecting:function(t){this.isSelecting&&(this.selectingBox[1]=[t[0],t[1]],this._setSelectionPolygonFromBox(),this.selectionPolygon.fullUpdate())},_stopSelecting:function(t){var e=this.getMousePosition(t);this.isSelecting=!1,this.selectingBox[1]=[e[0],e[1]],this._setSelectionPolygonFromBox()},_setSelectionPolygonFromBox:function(){var t=this.selectingBox[0],e=this.selectingBox[1];this.selectionPolygon.vertices[0].setPositionDirectly(i.Z.COORDS_BY_SCREEN,[t[0],t[1]]),this.selectionPolygon.vertices[1].setPositionDirectly(i.Z.COORDS_BY_SCREEN,[t[0],e[1]]),this.selectionPolygon.vertices[2].setPositionDirectly(i.Z.COORDS_BY_SCREEN,[e[0],e[1]]),this.selectionPolygon.vertices[3].setPositionDirectly(i.Z.COORDS_BY_SCREEN,[e[0],t[1]])},_testForSelection:function(t){this._isRequiredKeyPressed(t,"selection")&&(g.Z.exists(this.selectionPolygon)||this._createSelectionPolygon(this.attr),this.startSelectionMode())},_createSelectionPolygon:function(t){var e;return g.Z.exists(this.selectionPolygon)||!0!==(e=g.Z.copyAttributes(t,r.Z,"board","selection")).enabled||(this.selectionPolygon=this.create("polygon",[[0,0],[0,0],[0,0],[0,0]],e)),this},__evt__attribute:function(t){},__evt__down:function(t){},__evt__mousedown:function(t){},__evt__pendown:function(t){},__evt__pointerdown:function(t){},__evt__touchstart:function(t){},__evt__up:function(t){},__evt__mouseup:function(t){},__evt__pointerup:function(t){},__evt__touchend:function(t){},__evt__move:function(t,e){},__evt__mousemove:function(t,e){},__evt__penmove:function(t,e){},__evt__pointermove:function(t,e){},__evt__touchmove:function(t,e){},__evt__keymove:function(t,e){},__evt__hit:function(t,e,s){},__evt__mousehit:function(t,e,s){},__evt__update:function(){},__evt__boundingbox:function(){},__evt__startselecting:function(){},__evt__mousestartselecting:function(){},__evt__pointerstartselecting:function(){},__evt__touchstartselecting:function(){},__evt__stopselecting:function(){},__evt__mousestopselecting:function(){},__evt__pointerstopselecting:function(){},__evt__touchstopselecting:function(){},__evt__moveselecting:function(){},__evt__mousemoveselecting:function(){},__evt__pointermoveselecting:function(){},__evt__touchmoveselecting:function(){},__evt:function(){},toFullscreen:function(t){var e,s,i,o,n=this.document;return t=t||this.container,this._fullscreen_inner_id=t,i=n.getElementById(t),e="fullscreenwrap_"+t,g.Z.exists(i._cssFullscreenStore)||(o=this.containerObj.getBoundingClientRect(),i._cssFullscreenStore={w:o.width,h:o.height}),n.getElementById(e)?s=n.getElementById(e):((s=document.createElement("div")).classList.add("JXG_wrap_private"),s.setAttribute("id",e),i.parentNode.insertBefore(s,i),s.appendChild(i)),s.requestFullscreen=s.requestFullscreen||s.webkitRequestFullscreen||s.mozRequestFullScreen||s.msRequestFullscreen,null===(void 0!==n.fullscreenElement?n.fullscreenElement:void 0!==n.webkitFullscreenElement?n.webkitFullscreenElement:n.msFullscreenElement)?s.requestFullscreen&&(s.requestFullscreen(),this.startFullscreenResizeObserver(s)):(this.stopFullscreenResizeObserver(s),g.Z.exists(document.exitFullscreen)?document.exitFullscreen():g.Z.exists(document.webkitExitFullscreen)&&document.webkitExitFullscreen()),this},fullscreenListener:function(t){var e,s,i,o=this.document;e=this._fullscreen_inner_id,g.Z.exists(e)&&(i=void 0!==o.fullscreenElement?o.fullscreenElement:void 0!==o.webkitFullscreenElement?o.webkitFullscreenElement:o.msFullscreenElement,s=o.getElementById(e),i?(s._cssFullscreenStore.id=i.id,s._cssFullscreenStore.isFullscreen=!0,s._cssFullscreenStore.margin=s.style.margin,s._cssFullscreenStore.width=s.style.width,s._cssFullscreenStore.height=s.style.height,s._cssFullscreenStore.transform=s.style.transform,s.style.width=s._cssFullscreenStore.w+"px",s.style.height=s._cssFullscreenStore.h+"px",s.style.margin="",m.Z.scaleJSXGraphDiv(i.id,e,o,g.Z.evaluate(this.attr.fullscreen.scale)),i=null):g.Z.exists(s._cssFullscreenStore)&&(s._cssFullscreenStore.isFullscreen=!1,s.style.margin=s._cssFullscreenStore.margin,s.style.width=s._cssFullscreenStore.width,s.style.height=s._cssFullscreenStore.height,s.style.transform=s._cssFullscreenStore.transform,s._cssFullscreenStore=null,s.parentElement.replaceWith(s)),this.updateCSSTransforms())},startFullscreenResizeObserver:function(t){var e=this;return m.Z.isBrowser&&this.attr.resize&&this.attr.resize.enabled&&(this.resizeObserver=new ResizeObserver(function(s){var i,o,n=e.document;e._isResizing||(e._isResizing=!0,window.setTimeout(function(){try{i=e._fullscreen_inner_id,o=void 0!==n.fullscreenElement?n.fullscreenElement:void 0!==n.webkitFullscreenElement?n.webkitFullscreenElement:n.msFullscreenElement,null!==o&&m.Z.scaleJSXGraphDiv(o.id,i,n,g.Z.evaluate(e.attr.fullscreen.scale))}catch(s){e.stopFullscreenResizeObserver(t)}finally{e._isResizing=!1}},e.attr.resize.throttle))}),this.resizeObserver.observe(t)),this},stopFullscreenResizeObserver:function(t){return m.Z.isBrowser&&this.attr.resize&&this.attr.resize.enabled&&g.Z.exists(this.resizeObserver)&&this.resizeObserver.unobserve(t),this},addLogEntry:function(t,e,s){var i,o,n=this.userLog.length-1;return g.Z.exists(e.elementClass)&&(o=e.id),g.Z.evaluate(this.attr.logging.enabled)&&(i=new Date().getTime(),n>=0&&this.userLog[n].type===t&&this.userLog[n].id===o&&i-this.userLog[n].end<500?(this.userLog[n].end=i,this.userLog[n].endpos=s):this.userLog.push({type:t,id:o,start:i,startpos:s,end:i,endpos:s,bbox:this.getBoundingBox(),canvas:[this.canvasWidth,this.canvasHeight],zoom:[this.zoomX,this.zoomY]})),this},createRoulette:function(t,e,s,i,o,n,r){var c=this;return new function(){var u,d=0,p=0,g=0,v=s,m=h.Z.root(function(s){var i=t.X(v),o=t.Y(v),n=e.X(s),r=e.Y(s);return(i-n)*(i-n)+(o-r)*(o-r)},[0,2*Math.PI]),f=0,b=0,_=c.create("transform",[function(){return d}],{type:"rotate"}),O=c.create("transform",[function(){return d},function(){return t.X(v)},function(){return t.Y(v)}],{type:"rotate"}),Z=c.create("transform",[function(){return p},function(){return g}],{type:"translate"}),E=function(t,e,s){var i=h.Z.D(t.X)(e),o=h.Z.D(t.Y)(e),n=h.Z.D(t.X)(s),r=h.Z.D(t.Y)(s),c=h.Z.D(t.X)((e+s)*.5),l=h.Z.D(t.Y)((e+s)*.5),u=a.Z.hypot(i,o),d=a.Z.hypot(n,r);return(u+4*a.Z.hypot(c,l)+d)*(s-e)/6},y=function(t){return u-E(e,m,t)},C=Math.PI/18,w=9*C,x=null;return this.rolling=function(){var s,n,a,x,P;f=v+o*i,u=E(t,v,f),b=h.Z.root(y,m),s=new l.Z(t.X(f),t.Y(f)),n=new l.Z(e.X(b),e.Y(b)),a=new l.Z(h.Z.D(t.X)(f),h.Z.D(t.Y)(f)),x=new l.Z(h.Z.D(e.X)(b),h.Z.D(e.Y)(b)),d=Math.atan2((P=l.Z.C.div(a,x)).imaginary,P.real),P.div(l.Z.C.abs(P)),P.mult(n),p=s.real-P.real,g=s.imaginary-P.imaginary,d<-C&&d>-w?(d=-C,O.applyOnce(r)):d>C&&d<w?(d=C,O.applyOnce(r)):(_.applyOnce(r),Z.applyOnce(r),v=f,m=b),c.update()},this.start=function(){return n>0&&(x=window.setInterval(this.rolling,n)),this},this.stop=function(){return window.clearInterval(x),this},this}}}),e.Z=i.Z.Board}}]);